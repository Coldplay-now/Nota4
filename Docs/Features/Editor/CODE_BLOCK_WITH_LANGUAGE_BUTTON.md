# è·¨è¡Œä»£ç å—æŒ‰é’®å®ç°è¯´æ˜

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-11-19  
**çŠ¶æ€**: âœ… å·²å®ç°

---

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

åœ¨ç¼–è¾‘å™¨å·¥å…·æ ä¸­æ·»åŠ "è·¨è¡Œä»£ç å—"æŒ‰é’®ï¼Œç”¨äºæ’å…¥å¸¦è¯­è¨€æ ‡è¯†çš„ä»£ç å—ï¼ˆå¦‚ ` ```swift `ï¼‰ã€‚

---

## ğŸ¯ æŒ‰é’®ä½ç½®

### 1. ä¸»å·¥å…·æ ï¼ˆIndependentToolbarï¼‰

**ä½ç½®**: ç¼–è¾‘å™¨å†…å®¹åŒºåŸŸé¡¶éƒ¨  
**æ˜¾ç¤ºæ¡ä»¶**: çª—å£å®½åº¦ > 550pt

**æŒ‰é’®ç»„é¡ºåº**ï¼ˆåœ¨ `InsertButtonGroup` ä¸­ï¼‰ï¼š
1. ğŸ”— é“¾æ¥æŒ‰é’®ï¼ˆ`âŒ˜K`ï¼‰
2. `{}` ä»£ç å—æŒ‰é’®ï¼ˆ`â‡§âŒ˜K`ï¼‰
3. `123` **è·¨è¡Œä»£ç å—æŒ‰é’®**ï¼ˆ`âŒ˜âŒ¥K`ï¼‰â† **æ–°æŒ‰é’®**
4. ğŸ“· æ’å…¥å›¾ç‰‡æŒ‰é’®ï¼ˆ`âŒ˜â‡§I`ï¼‰

### 2. æ›´å¤šèœå•ï¼ˆMoreMenuï¼‰

å¦‚æœçª—å£å®½åº¦ < 550ptï¼ŒæŒ‰é’®ä¼šæ”¶èµ·åˆ°å·¥å…·æ å³ä¾§çš„"æ›´å¤š"ï¼ˆ`...`ï¼‰èœå•ä¸­ã€‚

**èœå•è·¯å¾„**: 
- æ›´å¤š â†’ æ’å…¥ â†’ è·¨è¡Œä»£ç å—ï¼ˆ`âŒ˜âŒ¥K`ï¼‰

### 3. å³é”®èœå•ï¼ˆEditorContextMenuï¼‰

åœ¨ç¼–è¾‘å™¨ä¸­å³é”®ç‚¹å‡»ï¼Œé€‰æ‹©"è·¨è¡Œä»£ç å—"ã€‚

---

## ğŸ” å¦‚ä½•æ‰¾åˆ°æŒ‰é’®

### æ–¹æ³• 1ï¼šæ£€æŸ¥å·¥å…·æ å®½åº¦

1. **ç¡®ä¿ç¼–è¾‘åŒºçª—å£è¶³å¤Ÿå®½**ï¼ˆ> 550ptï¼‰
2. æ‰“å¼€ä¸€ç¯‡ç¬”è®°
3. åœ¨ç¼–è¾‘å™¨é¡¶éƒ¨çš„å·¥å…·æ ä¸­æŸ¥æ‰¾

**å·¥å…·æ å¸ƒå±€**ï¼š
```
[ğŸ” æœç´¢] | [B I `] | [Aaâ–¼] | [â€¢ 1.] | [ğŸ”— {} 123 ğŸ“·] | [è¡¨æ ¼â–¼] | ...
                                         â†‘
                                    è¿™é‡Œæ˜¯æ–°æŒ‰é’®ï¼ˆ123å›¾æ ‡ï¼‰
```

### æ–¹æ³• 2ï¼šä½¿ç”¨å¿«æ·é”®

ç›´æ¥æŒ‰ `âŒ˜âŒ¥K` å³å¯æ’å…¥è·¨è¡Œä»£ç å—ï¼Œæ— éœ€ç‚¹å‡»æŒ‰é’®ã€‚

### æ–¹æ³• 3ï¼šä½¿ç”¨æ›´å¤šèœå•

1. ç‚¹å‡»å·¥å…·æ å³ä¾§çš„"æ›´å¤š"æŒ‰é’®ï¼ˆ`...`ï¼‰
2. é€‰æ‹©"æ’å…¥"éƒ¨åˆ†
3. ç‚¹å‡»"è·¨è¡Œä»£ç å—"

### æ–¹æ³• 4ï¼šä½¿ç”¨å³é”®èœå•

1. åœ¨ç¼–è¾‘å™¨ä¸­å³é”®ç‚¹å‡»
2. é€‰æ‹©"è·¨è¡Œä»£ç å—"

---

## ğŸ’» ä»£ç å®ç°

### 1. Action å®šä¹‰ï¼ˆEditorFeature.swiftï¼‰

```swift
enum Action {
    // ...
    case insertCodeBlock
    case insertCodeBlockWithLanguage  // æ–°å¢
    // ...
}
```

### 2. æ’å…¥å‡½æ•°ï¼ˆMarkdownTextEditor.swiftï¼‰

```swift
/// æ’å…¥å¸¦è¯­è¨€æ ‡è¯†çš„è·¨è¡Œä»£ç å—
static func insertCodeBlockWithLanguage(
    text: String,
    selection: NSRange,
    language: String = "swift"
) -> (newText: String, newSelection: NSRange) {
    // æœ‰é€‰ä¸­æ–‡æœ¬ï¼ŒåŒ…è£¹åœ¨ä»£ç å—ä¸­
    let insertion = "```\(language)\n\(selectedText)\n```"
    // ...
}
```

### 3. æŒ‰é’®ç»„ï¼ˆMarkdownToolbar.swiftï¼‰

```swift
struct InsertButtonGroup: View {
    let store: StoreOf<EditorFeature>
    
    var body: some View {
        WithPerceptionTracking {
            ControlGroup {
                linkButton
                codeBlockButton
                codeBlockWithLanguageButton  // æ–°å¢
                imageButton
            }
        }
    }
    
    private var codeBlockWithLanguageButton: some View {
        ToolbarButton(
            title: "è·¨è¡Œä»£ç å—",
            icon: "textformat.123",  // 123 å›¾æ ‡
            shortcut: "âŒ˜âŒ¥K",
            isActive: false,
            isEnabled: store.isToolbarEnabled
        ) {
            store.send(.insertCodeBlockWithLanguage)
        }
    }
}
```

### 4. å·¥å…·æ æ˜¾ç¤ºï¼ˆIndependentToolbar.swiftï¼‰

```swift
if availableWidth > 550 {
    Divider()
        .frame(height: 20)
    
    InsertButtonGroup(store: store)  // åŒ…å«æ–°æŒ‰é’®
    
    Divider()
        .frame(height: 20)
    
    TableMenu(store: store)
}
```

---

## ğŸ¨ æŒ‰é’®æ ·å¼

- **å›¾æ ‡**: `textformat.123`ï¼ˆ123 æ•°å­—æ ¼å¼ï¼‰
- **æ ‡é¢˜**: "è·¨è¡Œä»£ç å—"
- **å¿«æ·é”®**: `âŒ˜âŒ¥K`
- **å¤§å°**: 32x32pt
- **é¢œè‰²**: ç³»ç»Ÿæ§åˆ¶é¢œè‰²ï¼ˆè‡ªåŠ¨é€‚é…ä¸»é¢˜ï¼‰

---

## âœ… åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€/åˆ›å»ºç¬”è®°**
2. **æ‹‰å®½ç¼–è¾‘åŒºçª—å£**ï¼ˆç¡®ä¿å®½åº¦ > 550ptï¼‰
3. **æŸ¥çœ‹å·¥å…·æ **ï¼šåº”è¯¥èƒ½çœ‹åˆ°é“¾æ¥ã€ä»£ç å—ã€123ã€å›¾ç‰‡å››ä¸ªæŒ‰é’®
4. **ç‚¹å‡» 123 æŒ‰é’®**æˆ–æŒ‰ `âŒ˜âŒ¥K`
5. **æ£€æŸ¥æ’å…¥å†…å®¹**ï¼šåº”è¯¥æ’å…¥ ` ```swift\nä»£ç \n``` `

### é¢„æœŸç»“æœ

- æ— é€‰ä¸­æ–‡æœ¬æ—¶ï¼šæ’å…¥ ` ```swift\nä»£ç \n``` `ï¼Œå…‰æ ‡å®šä½åœ¨"ä»£ç "ä¸Š
- æœ‰é€‰ä¸­æ–‡æœ¬æ—¶ï¼šç”¨ ` ```swift\n...\n``` ` åŒ…è£¹é€‰ä¸­å†…å®¹

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šçœ‹ä¸åˆ°æŒ‰é’®

**åŸå› **: çª—å£å®½åº¦ä¸è¶³  
**è§£å†³**: æ‹‰å®½ç¼–è¾‘åŒºçª—å£ï¼Œç¡®ä¿å®½åº¦ > 550pt

### é—®é¢˜ 2ï¼šæŒ‰é’®æ˜¾ç¤ºä½†ç‚¹å‡»æ— æ•ˆ

**åŸå› **: ç¼–è¯‘æœªå®Œæˆæˆ–éœ€è¦é‡å¯  
**è§£å†³**: é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œåº”ç”¨

```bash
cd /Users/xt/LXT/code/trae/1107-model-eval/Nota4
make run
```

### é—®é¢˜ 3ï¼šå¿«æ·é”®å†²çª

**åŸå› **: `âŒ˜âŒ¥K` å¯èƒ½ä¸å…¶ä»–åº”ç”¨å†²çª  
**è§£å†³**: ä½¿ç”¨å³é”®èœå•æˆ–æ›´å¤šèœå•è®¿é—®

---

## ğŸ“ ä»£ç ä½ç½®

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `EditorFeature.swift` | æ·»åŠ  `insertCodeBlockWithLanguage` action |
| `MarkdownTextEditor.swift` | æ·»åŠ  `insertCodeBlockWithLanguage()` å‡½æ•° |
| `MarkdownToolbar.swift` | åœ¨ `InsertButtonGroup` ä¸­æ·»åŠ æŒ‰é’® |
| `IndependentToolbar.swift` | åœ¨ `MoreMenu` ä¸­æ·»åŠ èœå•é¡¹ |
| `EditorContextMenu.swift` | æ·»åŠ å³é”®èœå•é¡¹ |

---

## ğŸ¯ å…³é”®å‚æ•°

- **é»˜è®¤è¯­è¨€**: `swift`
- **å›¾æ ‡**: `textformat.123`
- **å¿«æ·é”®**: `âŒ˜âŒ¥K`
- **æ˜¾ç¤ºå®½åº¦**: > 550pt

---

## ğŸ“Š æ˜¾ç¤ºæ¡ä»¶æ€»ç»“

```
çª—å£å®½åº¦ | æŒ‰é’®ä½ç½®
---------|----------
> 550pt  | å·¥å…·æ ç›´æ¥æ˜¾ç¤ºï¼ˆæ¨èï¼‰
< 550pt  | æ›´å¤šèœå•ä¸­
ä»»æ„     | å³é”®èœå• / å¿«æ·é”®å¯ç”¨
```

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **å¯é…ç½®è¯­è¨€**: å…è®¸ç”¨æˆ·é€‰æ‹©é»˜è®¤è¯­è¨€ï¼ˆswift/python/javascriptç­‰ï¼‰
2. **è¯­è¨€èœå•**: æä¾›å¸¸ç”¨è¯­è¨€çš„ä¸‹æ‹‰é€‰æ‹©
3. **æ™ºèƒ½æ£€æµ‹**: æ ¹æ®æ–‡ä»¶å†…å®¹è‡ªåŠ¨æ¨èè¯­è¨€
4. **å¿«é€Ÿæ’å…¥**: åŒå‡»ä»£ç å—æŒ‰é’®å¯å¿«é€Ÿæ’å…¥å¸¸ç”¨è¯­è¨€

---

**æœ€åæ›´æ–°**: 2025-11-19  
**å®¡æ ¸çŠ¶æ€**: âœ… åŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡

