# 侧边栏滚动优化

**优化日期**: 2025-11-19 10:12:00  
**需求**: 将分类部分（全部/星标/删除）固定位置，标签列表可以滚动（如果标签多了的话）

---

## 📋 需求描述

### 用户需求

左侧分类栏内部有两个部分：
1. **分类部分**（全部/星标/删除）- 需要固定位置，不滚动
2. **标签列表部分** - 需要可以滚动（如果标签多了的话）

### 问题

之前的实现使用单个 `List` 包含两个 `Section`，导致：
- 整个列表一起滚动
- 分类部分也会滚动，不够直观
- 标签多时，分类部分可能被滚动出视野

---

## 🔍 实现方案

### 架构设计

使用 `VStack` 将两部分分开：
1. **分类部分**：使用固定的 `List`，设置固定高度
2. **标签部分**：使用 `ScrollView`，占用剩余空间

### 代码结构

```swift
VStack(spacing: 0) {
    // 分类部分：固定位置，不滚动
    VStack(spacing: 0) {
        // 分类标题
        HStack { ... }
        
        // 分类列表（固定高度）
        List { ... }
            .frame(height: CGFloat(Category.allCases.count) * 28 + 20)
    }
    
    Divider()
    
    // 标签部分：可滚动，占用剩余空间
    VStack(spacing: 0) {
        // 标签标题
        HStack { ... }
        
        // 标签列表（可滚动）
        if isTagsSectionExpanded {
            ScrollView {
                VStack { ... }
            }
        }
    }
    .frame(maxWidth: .infinity, maxHeight: .infinity)
}
```

---

## ✅ 实施的修改

### 1. 重构布局结构

**文件**: `SidebarView.swift`

**修改**:
- 从单个 `List` 改为 `VStack` 包含两个独立部分
- 分类部分使用固定的 `List`，设置固定高度
- 标签部分使用 `ScrollView`，占用剩余空间

### 2. 分类部分固定

**实现**:
- 使用 `List` 显示分类（全部/星标/删除）
- 设置固定高度：`CGFloat(Category.allCases.count) * 28 + 20`
- 使用 `.scrollDisabled(true)` 禁用滚动
- 分类部分不会滚动，始终可见，固定在顶部

### 3. 标签部分可滚动

**实现**:
- 使用 `ScrollView` 包裹标签列表
- 标签部分占用剩余空间：`.frame(maxWidth: .infinity, maxHeight: .infinity)`
- 当标签多时，可以滚动查看所有标签

### 4. 视觉分隔

**实现**:
- 使用 `Divider()` 分隔分类部分和标签部分
- 两部分都有独立的标题区域

---

## 🎯 预期效果

- ✅ 分类部分（全部/星标/删除）固定在顶部，始终可见
- ✅ 标签列表可以滚动，支持大量标签
- ✅ 两部分有清晰的视觉分隔
- ✅ 标签部分占用剩余空间，充分利用侧边栏高度

---

## 🔍 技术细节

### 固定高度计算

```swift
.frame(height: CGFloat(SidebarFeature.State.Category.allCases.count) * 32 + 40)
```

- `32`：每个分类项的高度（从28增加到32，确保完全可见）
- `40`：额外的内边距和间距（从20增加到40，确保底部有足够空间）
- 根据分类数量动态计算高度
- 确保所有分类项（全部笔记、星标笔记、已删除）都完全可见

### 禁用滚动

```swift
.scrollDisabled(true)
```

- 使用 `.scrollDisabled(true)` 禁用分类部分的滚动
- 确保分类部分始终固定在顶部，不会滚动

### 剩余空间占用

```swift
.frame(maxWidth: .infinity, maxHeight: .infinity)
```

- 标签部分使用 `maxHeight: .infinity` 占用剩余空间
- 确保标签列表可以充分利用侧边栏的垂直空间

### 滚动行为

- 分类部分：不滚动，固定位置
- 标签部分：使用 `ScrollView`，支持垂直滚动
- 当标签数量超过可见区域时，自动显示滚动条

---

## 📝 注意事项

1. **固定高度计算**：分类部分的高度是根据分类数量动态计算的，如果将来添加新的分类，需要确保高度计算正确
2. **标签展开/折叠**：标签部分可以通过标题栏的按钮展开/折叠，折叠时标签列表不显示
3. **滚动性能**：当标签数量非常多时，`ScrollView` 的性能应该足够好，因为 SwiftUI 的 `ScrollView` 使用了虚拟化技术

---

## 🔗 相关文档

- [分类栏边框上缘过高问题分析](./SIDEBAR_BORDER_ANALYSIS.md)
- [窗口标题栏分析](./TITLE_BAR_ANALYSIS.md)
- [整体布局设计方案](./LAYOUT_DESIGN_PROPOSAL.md)

---

---

## ✅ 修复记录

**修复日期**: 2025-11-19 10:15:00  
**问题**: 分类部分虽然设置了固定高度，但仍然可以滚动

**修复**:
- 在分类部分的 `List` 上添加 `.scrollDisabled(true)` 禁用滚动
- 确保分类部分完全固定，不会滚动
- 标签部分使用 `ScrollView`，可以正常滚动

**效果**:
- ✅ 分类部分（全部/星标/删除）固定在顶部，完全不可滚动
- ✅ 标签列表可以滚动，支持大量标签

---

---

## ✅ 高度调整记录

**调整日期**: 2025-11-19 10:18:00  
**问题**: 分类部分高度不够，导致"已删除"分类项被部分遮挡

**调整**:
- 每个分类项高度：从 `28pt` 增加到 `32pt`
- 额外内边距：从 `20pt` 增加到 `40pt`
- 总高度：从 `3 * 28 + 20 = 104pt` 增加到 `3 * 32 + 40 = 136pt`

**效果**:
- ✅ 所有分类项（全部笔记、星标笔记、已删除）都完全可见
- ✅ 分类部分有足够的空间，不会被遮挡

---

**最后更新**: 2025-11-19 10:18:00  
**维护者**: Nota4 开发团队

