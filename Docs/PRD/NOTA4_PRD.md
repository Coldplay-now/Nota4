# Nota4 产品需求文档 (PRD)

**文档版本**: v1.1.1  
**创建日期**: 2025-11-16  
**最后更新**: 2025-11-19 08:26:02  
**产品状态**: ✅ 已发布 (v1.1.1)

---

## 📋 目录

- [1. 产品概述](#1-产品概述)
- [2. 产品定位](#2-产品定位)
- [3. 目标用户](#3-目标用户)
- [4. 核心功能](#4-核心功能)
- [5. 技术架构](#5-技术架构)
- [6. 开发路线图](#6-开发路线图)
- [7. 竞品分析](#7-竞品分析)
- [8. 风险与挑战](#8-风险与挑战)
- [9. 成功指标](#9-成功指标)

---

## 1. 产品概述

### 1.1 产品简介

**Nota4** 是一款基于 SwiftUI 4.0 和 TCA (The Composable Architecture) 1.11 的现代化 macOS 原生 Markdown 笔记应用。它专为追求简洁、高效和优雅体验的 macOS 用户设计，提供流畅的笔记编写和管理体验。

### 1.2 产品愿景

**成为 macOS 平台上最优雅、最高效的本地优先 Markdown 笔记应用。**

### 1.3 产品使命

为用户提供：
- 🚀 **极致性能**: 即时保存、快速检索、丝滑操作
- 🎨 **优雅体验**: 精美界面、流畅动画、直观交互
- 💾 **数据安全**: 本地优先、完全控制、隐私保护
- 🔧 **简单高效**: 专注写作、减少干扰、提升效率

### 1.4 核心价值主张

| 价值 | 说明 |
|------|------|
| **原生体验** | 充分利用 macOS 15+ 和 SwiftUI 4.0 的最新特性 |
| **可预测性** | 基于 TCA 的单向数据流，状态管理清晰可测试 |
| **本地优先** | 数据完全本地存储，无需网络，完全掌控 |
| **开放格式** | 使用 `.nota` 专有格式（YAML + Markdown），易于迁移 |
| **高性能** | GRDB + FTS5 全文搜索，毫秒级响应 |

---

## 2. 产品定位

### 2.1 市场定位

- **平台**: 仅 macOS (13.0+，推荐 15.0+)
- **类型**: 本地优先的 Markdown 笔记应用
- **价格**: 免费开源（MIT License）
- **目标市场**: 个人用户、开发者、写作者

### 2.2 产品特色

#### 区别于其他笔记应用

| 特性 | Nota4 | Bear | Obsidian | Typora |
|------|-------|------|----------|--------|
| **原生 macOS** | ✅ SwiftUI | ❌ 非原生 | ❌ Electron | ✅ 原生 |
| **本地优先** | ✅ 完全本地 | ⚠️ 需同步订阅 | ✅ 本地 | ✅ 本地 |
| **开源免费** | ✅ MIT | ❌ 订阅制 | ⚠️ 部分免费 | ❌ 付费 |
| **TCA 架构** | ✅ 可测试 | ❌ | ❌ | ❌ |
| **专有格式** | `.nota` | 私有格式 | `.md` | `.md` |
| **性能** | 🚀 极快 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |

### 2.3 产品slogan

> **本地、优雅、高效 —— 你的 Markdown 笔记伙伴**

---

## 3. 目标用户

### 3.1 用户画像

#### 主要用户群体

**用户 A: 技术开发者**
- **特征**: 熟悉 Markdown，追求效率，重视隐私
- **需求**: 技术文档、代码笔记、学习记录
- **痛点**: 不想数据上云，需要快速搜索，代码支持好
- **使用场景**: 技术博客草稿、API 文档、学习笔记

**用户 B: 知识工作者**
- **特征**: 需要整理大量信息，建立知识体系
- **需求**: 会议记录、项目文档、个人知识库
- **痛点**: 需要标签分类，快速检索，数据安全
- **使用场景**: 每日工作日志、项目管理、知识沉淀

**用户 C: 写作爱好者**
- **特征**: 喜欢用 Markdown 写作，追求简洁
- **需求**: 博客文章、随笔、创意记录
- **痛点**: 界面要美观，分心要少，导出要方便
- **使用场景**: 博客创作、日记、灵感记录

---

## 4. 核心功能

### 4.1 功能清单

#### v1.1.1 已实现功能（当前版本）

##### 基础功能

| 功能 | 描述 | 状态 | 优先级 |
|------|------|------|--------|
| **笔记编辑** | Markdown 实时编辑 | ✅ 已实现 | P0 |
| **实时预览** | 三种视图模式（编辑/预览/分屏） | ✅ 已实现 | P0 |
| **自动保存** | 800ms 防抖自动保存 | ✅ 已实现 | P0 |
| **笔记列表** | 列表显示、搜索、排序 | ✅ 已实现 | P0 |
| **侧边栏** | 分类（全部/星标/回收站） | ✅ 已实现 | P0 |
| **标签系统** | 创建、管理、过滤标签 | ✅ 已实现 | P0 |
| **全文搜索** | FTS5 全文检索 | ✅ 已实现 | P0 |
| **编辑器搜索** | 编辑器内搜索和替换 | ✅ 已实现 | P1 |
| **回收站** | 软删除机制 | ✅ 已实现 | P1 |
| **导入导出** | Nota/Markdown/Text/HTML/PDF/PNG 格式 | ✅ 已实现 | P1 |
| **星标置顶** | 星标和置顶功能 | ✅ 已实现 | P1 |
| **图片管理** | 本地图片插入和管理 | ✅ 已实现 | P1 |
| **主题系统** | 明暗主题、自定义主题 | ✅ 已实现 | P1 |
| **布局系统** | 三栏/两栏/一栏布局切换 | ✅ 已实现 | P1 |
| **编辑器设置** | 字体、行距、边距等设置 | ✅ 已实现 | P1 |

##### 技术特性

| 特性 | 描述 | 状态 |
|------|------|------|
| **TCA 架构** | 单向数据流，可测试 | ✅ 已实现 |
| **Actor 并发** | Swift 并发模型 | ✅ 已实现 |
| **GRDB 数据库** | SQLite + FTS5 | ✅ 已实现 |
| **专有格式** | `.nota` (YAML + Markdown) | ✅ 已实现 |
| **测试覆盖** | 94 个测试，100% 通过率 | ✅ 已实现 |

#### v1.2.0 计划功能

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **标签增强** | 标签颜色、标签云、标签重命名 | P1 |
| **快捷键系统** | 全局快捷键、编辑器快捷键 | P1 |
| **性能优化** | 大文件优化、搜索优化 | P1 |
| **Spotlight 集成** | 系统级搜索 | P2 |
| **版本历史** | 笔记历史版本 | P2 |
| **iCloud 同步** | 可选云同步 | P3 |
| **插件系统** | 扩展能力 | P3 |

### 4.2 功能详细说明

#### 4.2.1 笔记编辑

**核心体验**:
- 标题独立输入框（自动保存）
- Markdown 编辑器（支持语法高亮）
- 自动保存（800ms 防抖）
- 手动保存快捷键（⌘S）

**Markdown 支持**:
- 基础语法：标题、列表、引用、代码块
- 扩展语法：表格、任务列表、脚注、数学公式
- Mermaid 图表：流程图、时序图、甘特图等
- 快捷插入：粗体、斜体、链接、代码

**视图模式**:
1. **仅编辑模式**: 专注写作
2. **仅预览模式**: 阅读优化
3. **分屏模式**: 实时预览

**编辑器设置**:
- 字体设置：标题字体、正文字体、代码字体
- 排版设置：行距、段落间距、最大行宽
- 布局设置：左右边距、上下边距、对齐方式

#### 4.2.2 笔记管理

**列表功能**:
- 显示：标题、预览（前 100 字）、更新时间
- 排序：按更新时间、创建时间、标题
- 筛选：按分类、按标签、按关键词
- 多选：批量操作（删除、导出、标记）

**分类系统**:
- **全部笔记**: 显示所有非删除笔记
- **星标笔记**: 重要笔记快速访问
- **回收站**: 软删除，支持恢复和永久删除

**标签系统**:
- 标签列表：显示标签名和笔记数量
- 多标签筛选：支持同时选择多个标签（AND 逻辑）
- 标签管理：自动从笔记中提取和更新

#### 4.2.3 搜索功能

**全文搜索**:
- 技术：GRDB FTS5（全文搜索扩展）
- 搜索范围：标题 + 内容
- 性能：毫秒级响应
- 防抖：300ms 避免频繁查询
- 高亮：搜索结果关键词高亮

**编辑器搜索**:
- 编辑器内搜索和替换
- 实时高亮显示
- 支持正则表达式（计划中）

#### 4.2.4 布局系统

**布局模式**:
- **三栏布局**: 侧边栏 + 笔记列表 + 编辑器
- **两栏布局**: 笔记列表 + 编辑器
- **一栏布局**: 仅编辑器

**布局切换**:
- 菜单栏切换
- 状态栏下拉菜单
- 快捷键：⇧⌘1/2/3
- 快速切换：⇧⌘L

**宽度记忆**:
- 记住用户调整的栏宽度
- 不同布局模式独立保存宽度

#### 4.2.5 主题系统

**内置主题**:
- Light（浅色主题）
- Dark（深色主题）
- GitHub（GitHub 风格）
- Notion（Notion 风格）

**代码高亮主题**:
- Xcode
- GitHub
- Monokai
- Dracula
- Solarized Light/Dark

**Mermaid 图表主题**:
- default
- dark
- forest
- neutral

#### 4.2.6 数据格式

**`.nota` 文件格式**:

```yaml
---
id: 550E8400-E29B-41D4-A716-446655440000
title: 示例笔记
created: 2025-11-16T09:00:00.000Z
updated: 2025-11-16T09:22:00.000Z
starred: false
pinned: false
deleted: false
tags:
  - 工作
  - Swift
---

# 笔记内容

这里是 Markdown 内容...
```

**格式优势**:
- ✅ 可读性好：纯文本，易于版本控制
- ✅ 可迁移：标准格式，易于导入其他工具
- ✅ 可扩展：YAML 支持任意元数据
- ✅ 可解析：多种工具支持 YAML + Markdown

#### 4.2.7 导入导出

**支持格式**:

| 格式 | 导入 | 导出 | 说明 |
|------|------|------|------|
| `.nota` | ✅ | ✅ | 完整保留元数据 |
| `.md` | ✅ | ✅ | Markdown 格式 |
| `.txt` | ✅ | ✅ | 纯文本格式 |
| `.html` | ❌ | ✅ | HTML 导出（支持主题） |
| `.pdf` | ❌ | ✅ | PDF 导出 |
| `.png` | ❌ | ✅ | PNG 图片导出 |

**导入策略**:
- 自动生成新 ID 避免冲突
- 保留原始创建/更新时间（如有）
- 从文件名提取标题
- 批量导入支持

**导出选项**:
- 单个笔记导出
- 批量笔记导出
- 选择导出格式
- 选择导出位置
- HTML/PDF/PNG 支持主题和 TOC

---

## 5. 技术架构

### 5.1 技术栈

| 技术 | 版本 | 用途 | 选择理由 |
|------|------|------|---------|
| **SwiftUI** | 4.0+ | UI 框架 | 原生、声明式、现代 |
| **TCA** | 1.11+ | 状态管理 | 可测试、可预测、模块化 |
| **GRDB** | 6.0+ | 数据库 | 性能优秀、FTS5 支持 |
| **MarkdownUI** | 2.0+ | Markdown 渲染 | SwiftUI 原生、可定制 |
| **Yams** | 5.0+ | YAML 解析 | 纯 Swift、性能好 |

### 5.2 系统要求

| 项目 | 要求 | 推荐 |
|------|------|------|
| **macOS** | 13.0+ (Ventura) | 15.0+ (Sequoia) |
| **内存** | 4GB | 8GB+ |
| **存储** | 100MB | 1GB+ |
| **处理器** | Apple Silicon / Intel | Apple Silicon |

### 5.3 架构设计

详见: [系统架构文档](../Architecture/SYSTEM_ARCHITECTURE.md)

---

## 6. 开发路线图

### 6.1 版本规划

```
v1.0.0 MVP ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ ✅ 已完成
  ├─ Week 1: 项目初始化与架构搭建                      │ ✅ 完成
  ├─ Week 2: 数据层实现                                │ ✅ 完成
  ├─ Week 3: 笔记列表与侧边栏                          │ ✅ 完成
  ├─ Week 4: 编辑器与预览                              │ ✅ 完成
  └─ Week 5: 导入导出与测试                            │ ✅ 完成

v1.1.0 功能增强 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ ✅ 已完成
  ├─ 编辑器工具栏搜索功能                               │ ✅ 完成
  ├─ 图片预览功能修复                                   │ ✅ 完成
  ├─ UI/UX 优化                                        │ ✅ 完成
  ├─ 导出功能增强（PDF/HTML/PNG）                      │ ✅ 完成
  └─ 主题系统                                          │ ✅ 完成

v1.1.1 视觉更新 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ ✅ 已完成
  └─ 新图标设计                                         │ ✅ 完成

v1.2.0 高级功能 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ 📅 计划中
  ├─ 标签增强（颜色、重命名）                            │ 1-2周
  ├─ 快捷键系统                                         │ 1周
  ├─ Spotlight 集成                                    │ 2-3周
  └─ 版本历史                                           │ 2-3周
```

### 6.2 里程碑

| 里程碑 | 日期 | 状态 | 描述 |
|--------|------|------|------|
| **M1: 架构完成** | 2025-11-15 | ✅ 完成 | TCA 架构搭建完成 |
| **M2: 数据层完成** | 2025-11-15 | ✅ 完成 | GRDB + 文件管理完成 |
| **M3: MVP 完成** | 2025-11-16 | ✅ 完成 | 所有核心功能实现 |
| **M4: 测试完成** | 2025-11-16 | ✅ 完成 | 100% 测试通过率 |
| **M5: v1.1.0 发布** | 2025-11-17 | ✅ 完成 | 功能增强版本 |
| **M6: v1.1.1 发布** | 2025-11-17 | ✅ 完成 | 视觉更新版本 |
| **M7: v1.2.0 开发** | 2025-12 | 📅 计划中 | 高级功能开发 |

---

## 7. 竞品分析

### 7.1 主要竞品

#### Bear

**优势**:
- 界面精美，用户体验好
- iCloud 同步流畅
- 标签系统强大

**劣势**:
- 订阅制，价格较高
- 非原生技术栈
- 数据格式私有

**差异化**: Nota4 完全免费开源，原生性能更好

#### Obsidian

**优势**:
- 插件生态丰富
- 双向链接
- 本地优先

**劣势**:
- Electron 性能一般
- 界面不够原生
- 学习曲线陡峭

**差异化**: Nota4 更专注简洁，性能更优

#### Typora

**优势**:
- 所见即所得编辑
- 界面简洁
- 导出功能强

**劣势**:
- 付费软件
- 功能相对简单
- 无标签系统

**差异化**: Nota4 免费且功能更全面

### 7.2 竞争策略

1. **差异化定位**: 原生 + 开源 + 高性能
2. **技术优势**: TCA 架构，可测试性强
3. **社区驱动**: 开源项目，接受贡献
4. **持续迭代**: 快速响应用户需求

---

## 8. 风险与挑战

### 8.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| macOS 版本兼容性 | 中 | 低 | 支持 macOS 13.0+ |
| TCA 学习曲线陡 | 中 | 低 | 完善文档和示例 |
| 性能问题（大文件） | 高 | 中 | 虚拟化、分页加载 |
| 数据迁移复杂 | 中 | 低 | 提供迁移工具 |

### 8.2 产品风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 用户获取困难 | 高 | 高 | GitHub 推广、博客宣传 |
| 功能过于简单 | 中 | 中 | 快速迭代新功能 |
| 竞品压力大 | 中 | 高 | 强化差异化优势 |
| 维护成本高 | 低 | 低 | 代码质量优先 |

---

## 9. 成功指标

### 9.1 技术指标

| 指标 | 目标 | 当前 | 状态 |
|------|------|------|------|
| 测试覆盖率 | ≥ 80% | 100% | ✅ 超额 |
| 编译警告数 | 0 | 0 | ✅ 达成 |
| 构建时间 | < 30s | ~5s | ✅ 优秀 |
| 应用启动时间 | < 1s | ~0.5s | ✅ 优秀 |
| 内存占用 | < 200MB | ~100MB | ✅ 优秀 |

### 9.2 用户指标

| 指标 | v1.0.0 目标 | v1.1.0 实际 | v1.2.0 目标 |
|------|------------|------------|------------|
| GitHub Stars | 100 | 50+ | 500 |
| 下载量 | 1,000 | 500+ | 5,000 |
| 活跃用户 | 500 | 200+ | 2,000 |
| 用户反馈 | 10 | 5+ | 50 |

### 9.3 质量指标

| 指标 | 目标 | 验证方式 |
|------|------|---------|
| Crash Rate | < 0.1% | Crash 报告 |
| Bug 修复时间 | < 48h | Issue 追踪 |
| 性能问题 | 0 重大问题 | 性能测试 |
| 用户满意度 | > 4.5/5 | 用户调研 |

---

## 10. 附录

### 10.1 术语表

| 术语 | 定义 |
|------|------|
| **TCA** | The Composable Architecture，可组合架构 |
| **FTS5** | SQLite 全文搜索扩展 |
| **YAML Front Matter** | Markdown 文件头部的 YAML 元数据 |
| **Actor** | Swift 并发模型中的并发安全类型 |
| **防抖** | Debounce，延迟执行以减少频繁触发 |

### 10.2 参考资料

- [TCA 官方文档](https://pointfreeco.github.io/swift-composable-architecture/)
- [SwiftUI 文档](https://developer.apple.com/documentation/swiftui)
- [GRDB 文档](https://github.com/groue/GRDB.swift)
- [Markdown 规范](https://commonmark.org/)

### 10.3 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| v1.0.0 | 2025-11-16 | 初始版本创建 | Nota4 Team |
| v1.1.0 | 2025-11-17 | 功能增强版本 | Nota4 Team |
| v1.1.1 | 2025-11-19 | 更新PRD，反映实际功能 | Nota4 Team |

---

## 📞 联系方式

- **GitHub**: https://github.com/Coldplay-now/Nota4
- **Issues**: https://github.com/Coldplay-now/Nota4/issues
- **Discussions**: https://github.com/Coldplay-now/Nota4/discussions

---

**文档维护者**: Nota4 开发团队  
**最后审核**: 2025-11-19  
**文档状态**: ✅ 活跃维护中
