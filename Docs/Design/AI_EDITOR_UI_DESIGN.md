# AI 编辑器功能 UI 设计文档

**创建日期**: 2025-11-25 12:09:12  
**版本**: v1.0  
**状态**: 设计完成

---

## 1. 概述

本文档详细描述 AI 编辑器功能的 UI 设计，包括设置面板和编辑对话框的界面布局、交互设计和视觉规范。

### 1.1 设计原则

1. **一致性**：遵循 macOS HIG（Human Interface Guidelines）和 Nota4 现有设计风格
2. **清晰性**：界面元素清晰，信息层级明确
3. **易用性**：操作流程简单直观，减少用户学习成本
4. **响应性**：及时反馈用户操作，提供加载和错误状态

---

## 2. 设置面板设计

### 2.1 整体布局

**位置**：设置窗口 → "AI 助手"分类（第三个分类，位于"外观"之后）

**布局结构**：
```
┌─────────────────────────────────────────┐
│  设置侧边栏          │  设置内容区域      │
│                    │                   │
│  • 编辑器          │  ┌─────────────┐  │
│  • 外观            │  │ API 配置     │  │
│  • AI 助手  ←选中  │  │             │  │
│                    │  │ [配置项...] │  │
│                    │  └─────────────┘  │
│                    │                   │
│                    │  ┌─────────────┐  │
│                    │  │ 系统提示词  │  │
│                    │  │             │  │
│                    │  │ [编辑器...] │  │
│                    │  └─────────────┘  │
│                    │                   │
│                    │  [应用] [取消]    │
└─────────────────────────────────────────┘
```

### 2.2 分类图标和描述

**AI 助手分类**：
- **图标**：`sparkles`（SF Symbols）
- **标题**：`"AI 助手"`
- **描述**：`"LLM API 配置和系统提示词设置"`

### 2.3 API 配置分组

**分组标题**：`"API 配置"`

**布局**：
```
┌─────────────────────────────────────┐
│ API 配置                            │
│                                     │
│ API 端点                            │
│ ┌─────────────────────────────────┐ │
│ │ https://api.deepseek.com/...    │ │
│ └─────────────────────────────────┘ │
│ DeepSeek API 端点地址                │
│                                     │
│ API Key                             │
│ ┌─────────────────────────────────┐ │
│ │ •••••••••••••••••••••••••••••• │ │
│ └─────────────────────────────────┘ │
│ 请输入您的 DeepSeek API Key          │
│                                     │
│ 模型名称                             │
│ ┌─────────────────────────────────┐ │
│ │ deepseek-chat                   │ │
│ └─────────────────────────────────┘ │
│ DeepSeek 模型名称                    │
└─────────────────────────────────────┘
```

**设计规范**：
- **分组间距**：16pt
- **标签字体**：`.headline`（系统字体，17pt）
- **输入框高度**：单行输入框 28pt
- **说明文字**：`.caption`（系统字体，12pt），颜色 `.secondary`
- **输入框样式**：系统标准 `TextField` 和 `SecureField`
- **API Key 输入框**：使用 `SecureField`，显示为密码框

### 2.4 系统提示词分组

**分组标题**：`"系统提示词"`

**布局**：
```
┌─────────────────────────────────────┐
│ 系统提示词                          │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 你是一个专业的 Markdown 笔记    │ │
│ │ 助手。你的任务是帮助用户生成、  │ │
│ │ 改写和优化 Markdown 格式的笔记  │ │
│ │ 内容。                          │ │
│ │                                 │ │
│ │ 要求：                          │ │
│ │ 1. 输出内容必须是有效的         │ │
│ │    Markdown 格式                │ │
│ │ 2. 保持内容简洁、清晰、有条理   │ │
│ │ ...                             │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 用于指导 AI 生成内容的系统提示词，  │
│ 可以自定义修改                      │
└─────────────────────────────────────┘
```

**设计规范**：
- **编辑器高度**：200pt（8-10 行）
- **编辑器样式**：系统标准 `TextEditor`
- **边框**：系统默认边框（浅灰色）
- **字体**：等宽字体（`Menlo` 或 `SF Mono`），14pt
- **行间距**：系统默认
- **可编辑**：用户可以完全编辑

### 2.5 操作按钮

**位置**：设置窗口底部

**布局**：
```
┌─────────────────────────────────────┐
│                                     │
│                    [应用] [取消]    │
└─────────────────────────────────────┘
```

**设计规范**：
- **按钮位置**：右侧对齐
- **按钮间距**：12pt
- **按钮样式**：
  - "应用"：`.borderedProminent`（主要按钮）
  - "取消"：`.bordered`（次要按钮）
- **快捷键**：
  - "应用"：`⌘⏎`（Command + Enter）
  - "取消"：`ESC`

---

## 3. AI 编辑对话框设计

### 3.1 对话框整体布局

**尺寸**：600pt × 400pt（固定）

**布局结构**：
```
┌─────────────────────────────────────┐
│  AI 编辑助手                        │
│                                     │
│  请输入您的需求                      │
│  ┌─────────────────────────────────┐ │
│  │ 描述您希望 AI 生成的内容         │ │
│  │                                 │ │
│  │                                 │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ☐ 包含当前笔记内容作为上下文        │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 生成内容                        │ │
│  │                                 │ │
│  │ [生成的内容预览...]            │ │
│  │                                 │ │
│  └─────────────────────────────────┘ │
│                                     │
│  [取消] [清除]          [生成/确认] │
└─────────────────────────────────────┘
```

### 3.2 对话框标题

**文本**：`"AI 编辑助手"`

**设计规范**：
- **字体**：`.title2`（系统字体，22pt）
- **字重**：`.semibold`
- **位置**：顶部居中或左对齐
- **间距**：顶部 20pt，底部 16pt

### 3.3 输入区域

**标签**：`"请输入您的需求"`

**输入框**：
- **类型**：多行文本编辑器（`TextEditor`）
- **高度**：120pt（5-6 行）
- **占位符**：`"描述您希望 AI 生成的内容"`
- **字符限制**：500 字符（超出时显示提示）
- **边框**：浅灰色边框（`Color.secondary.opacity(0.3)`）
- **圆角**：4pt

**设计规范**：
- **标签字体**：`.headline`（系统字体，17pt）
- **标签间距**：标签下方 8pt
- **输入框字体**：系统默认字体，14pt
- **输入框内边距**：8pt

### 3.4 上下文开关

**布局**：
```
☐ 包含当前笔记内容作为上下文
```

**设计规范**：
- **控件类型**：`Toggle`（复选框）
- **位置**：输入框下方，间距 12pt
- **字体**：系统默认字体，14pt
- **默认状态**：关闭（`false`）
- **说明**：当开关打开时，可以显示当前笔记标题和前 500 字符预览（可选）

### 3.5 预览区域

**显示条件**：开始生成后显示（`showContentPreview == true`）

**布局**：
```
┌─────────────────────────────────────┐
│ 生成内容                            │
│ ┌─────────────────────────────────┐ │
│ │ # 标题                          │ │
│ │                                 │ │
│ │ 这是生成的内容...               │ │
│ │                                 │ │
│ │ - 列表项 1                      │ │
│ │ - 列表项 2                      │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**设计规范**：
- **标签**：`"生成内容"`（`.headline`，17pt）
- **高度**：200-250pt（可滚动）
- **背景色**：`Color(nsColor: .textBackgroundColor)`
- **边框**：浅灰色边框，圆角 4pt
- **内边距**：12pt
- **字体**：系统默认字体，14pt
- **只读**：不可编辑（初期）
- **流式显示**：生成过程中内容逐步追加显示

### 3.6 错误消息

**显示位置**：预览区域下方或对话框底部

**设计规范**：
- **字体**：`.caption`（系统字体，12pt）
- **颜色**：`.red`
- **位置**：预览区域下方，间距 8pt
- **内容**：简要错误信息（如"网络错误"、"API 调用失败"等）

### 3.7 操作按钮

**布局**（生成前）：
```
[取消]                    [生成]
```

**布局**（生成后）：
```
[取消] [清除]          [确认插入]
```

**设计规范**：
- **按钮位置**：水平排列
- **左侧按钮**：`[取消]` 和 `[清除]`（可选，仅在生成后显示）
- **右侧按钮**：`[生成]` 或 `[确认插入]`（主要操作）
- **按钮样式**：
  - "生成"/"确认插入"：`.borderedProminent`（蓝色背景）
  - "取消"/"清除"：`.bordered`（灰色边框）
- **按钮间距**：12pt
- **快捷键**：
  - "生成"：`⌘⏎`（Command + Enter）
  - "取消"：`ESC`
- **禁用状态**：
  - "生成"按钮：当输入框为空或正在生成时禁用
  - 禁用时显示加载指示器（如果正在生成）

### 3.8 加载状态

**显示位置**：生成按钮内或预览区域

**设计规范**：
- **生成中**：按钮显示加载指示器（`ProgressView()`）
- **按钮文本**：可以显示"生成中..."或保持"生成"文本
- **预览区域**：可以显示加载动画（可选）

---

## 4. 工具栏按钮设计

### 4.1 按钮位置

**位置**：编辑器工具栏，"插入组"之后

**工具栏布局**：
```
[格式组] | [标题] | [列表组] | [插入组] | [AI编辑] | [更多] ... [视图模式]
```

### 4.2 按钮样式

**图标**：`sparkles`（SF Symbols）

**标题**：`"AI 编辑"`

**设计规范**：
- **按钮组件**：`NoteListToolbarButton`（与其他工具栏按钮一致）
- **图标大小**：与其他按钮一致
- **点击区域**：32×32pt
- **工具提示**：`"使用 AI 生成或编辑内容"`
- **启用条件**：当有笔记打开时启用（`store.note != nil`）

---

## 5. 交互流程

### 5.1 完整流程

```
1. 用户点击工具栏"AI 编辑"按钮
   ↓
2. 显示对话框（初始状态）
   - 输入框为空
   - 上下文开关关闭
   - 预览区域隐藏
   ↓
3. 用户输入需求
   - 输入框实时更新
   - 字符计数（可选）
   ↓
4. 用户选择是否包含上下文（可选）
   - 切换开关
   ↓
5. 用户点击"生成"按钮
   ↓
6. 验证输入和配置
   - 检查输入框非空
   - 检查 API Key 已配置
   ↓
7. 显示预览区域
   - 初始为空
   ↓
8. 流式输出内容
   - 内容逐步显示在预览区域
   - 按钮显示加载状态
   ↓
9. 生成完成
   - 显示完整内容
   - 按钮变为"确认插入"
   ↓
10. 用户查看预览
    ↓
11. 用户点击"确认插入"
    ↓
12. 内容插入到编辑器末尾（带标记）
    ↓
13. 关闭对话框
    ↓
14. 触发自动保存
```

### 5.2 错误处理流程

```
生成失败
  ↓
显示错误消息（红色文字）
  ↓
显示"重试"按钮
  ↓
用户点击"重试"
  ↓
重新执行生成流程
```

---

## 6. 视觉规范

### 6.1 颜色

- **主要按钮**：系统蓝色（`.accentColor`）
- **次要按钮**：系统灰色边框
- **错误文字**：`.red`
- **说明文字**：`.secondary`
- **边框**：`Color.secondary.opacity(0.3)`

### 6.2 字体

- **标题**：`.title2`（22pt，semibold）
- **分组标题**：`.headline`（17pt）
- **标签**：`.headline`（17pt）
- **正文**：系统默认（14pt）
- **说明文字**：`.caption`（12pt）

### 6.3 间距

- **对话框内边距**：20pt
- **元素间距**：16-20pt
- **分组间距**：24pt
- **按钮间距**：12pt

### 6.4 圆角

- **输入框**：4pt
- **预览区域**：4pt
- **按钮**：系统默认（6pt）

---

## 7. 响应式设计

### 7.1 对话框尺寸

- **固定尺寸**：600pt × 400pt
- **最小尺寸**：不支持调整（初期）
- **未来扩展**：可以考虑可调整大小

### 7.2 内容适配

- **预览区域**：内容过长时自动滚动
- **输入框**：内容过长时自动滚动
- **错误消息**：自动换行

---

## 8. 可访问性

### 8.1 键盘导航

- **Tab**：在输入框和按钮之间切换
- **⌘⏎**：触发"生成"或"确认插入"
- **ESC**：关闭对话框

### 8.2 VoiceOver 支持

- 所有 UI 元素提供适当的标签
- 状态变化时提供语音反馈
- 错误消息可被 VoiceOver 读取

---

## 9. 动画和过渡

### 9.1 对话框显示/隐藏

- **显示**：淡入动画（系统默认）
- **隐藏**：淡出动画（系统默认）

### 9.2 预览区域显示

- **显示**：淡入动画（可选）
- **内容更新**：平滑滚动到底部（流式输出时）

### 9.3 加载状态

- **加载指示器**：旋转动画
- **按钮状态变化**：平滑过渡

---

## 10. 设计检查清单

- [ ] 设置面板布局符合 macOS HIG
- [ ] 对话框尺寸和布局合理
- [ ] 所有交互元素有清晰的视觉反馈
- [ ] 错误状态有明确的视觉提示
- [ ] 加载状态有明确的指示
- [ ] 键盘快捷键符合用户习惯
- [ ] 支持 VoiceOver
- [ ] 颜色对比度符合可访问性标准
- [ ] 字体大小适合阅读
- [ ] 间距和布局符合设计规范

---

**文档结束**

