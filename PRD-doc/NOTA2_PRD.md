# Nota2 äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

> **ç‰ˆæœ¬**: v1.0.1  
> **æ›´æ–°æ—¥æœŸ**: 2025-11-15  
> **äº§å“å®šä½**: macOS åŸç”Ÿ Markdown ç¬”è®°åº”ç”¨ï¼Œä¸“æ³¨äºå¿«é€Ÿè®°å½•å’Œç®¡ç†

---

## ğŸ“‹ ç›®å½•

1. [äº§å“æ¦‚è¿°](#1-äº§å“æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#2-æ ¸å¿ƒåŠŸèƒ½)
3. [ç•Œé¢ç»“æ„](#3-ç•Œé¢ç»“æ„)
4. [äº¤äº’è®¾è®¡](#4-äº¤äº’è®¾è®¡)
5. [æ•°æ®æ¶æ„](#5-æ•°æ®æ¶æ„)
6. [æŠ€æœ¯å®ç°](#6-æŠ€æœ¯å®ç°)
7. [æ–‡ä»¶æ ¼å¼](#7-æ–‡ä»¶æ ¼å¼)

---

## 1. äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½
Nota2 æ˜¯ä¸€æ¬¾ **macOS åŸç”Ÿ Markdown ç¬”è®°åº”ç”¨**ï¼Œé‡‡ç”¨æœ¬åœ°å­˜å‚¨ï¼Œæ”¯æŒå³æ—¶ä¿å­˜ã€å¿«é€Ÿæœç´¢å’Œçµæ´»ç®¡ç†ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼
- âœ… **å³æ—¶ä¿å­˜**ï¼š0.8 ç§’é˜²æŠ–è‡ªåŠ¨ä¿å­˜ï¼Œæ— éœ€æ‰‹åŠ¨ä¿å­˜
- âœ… **æç®€äº¤äº’**ï¼šä¸“æ³¨å†™ä½œï¼Œå‡å°‘å¹²æ‰°
- âœ… **æœ¬åœ°ä¼˜å…ˆ**ï¼šæ•°æ®å®Œå…¨æœ¬åœ°å­˜å‚¨ï¼Œæ— äº‘ç«¯ä¾èµ–
- âœ… **å¿«é€Ÿæ£€ç´¢**ï¼šå…¨æ–‡æœç´¢ï¼Œå®æ—¶é«˜äº®
- âœ… **åŸç”Ÿä½“éªŒ**ï¼šmacOS åŸç”Ÿ UIï¼Œæ€§èƒ½ä¼˜å¼‚

### 1.3 ç›®æ ‡ç”¨æˆ·
- å¼€å‘è€…ã€è®¾è®¡å¸ˆã€äº§å“ç»ç†
- éœ€è¦å¿«é€Ÿè®°å½•æƒ³æ³•å’ŒçŸ¥è¯†ç®¡ç†çš„ç”¨æˆ·
- é‡è§†æ•°æ®éšç§å’Œæœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·

---

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 åŠŸèƒ½æ¸…å•

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½ç‚¹ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|---------|--------|--------|------|
| **ç¬”è®°ç®¡ç†** | åˆ›å»ºç¬”è®° | P0 | âœ… å·²å®ç° |
| | ç¼–è¾‘ç¬”è®° | P0 | âœ… å·²å®ç° |
| | åˆ é™¤ç¬”è®°ï¼ˆè½¯åˆ é™¤ï¼‰ | P0 | âœ… å·²å®ç° |
| | æ°¸ä¹…åˆ é™¤ | P1 | âœ… å·²å®ç° |
| | æ¢å¤ç¬”è®° | P1 | âœ… å·²å®ç° |
| | æ‰¹é‡æ“ä½œï¼ˆå¤šé€‰ï¼‰ | P1 | âœ… å·²å®ç° |
| **ç¬”è®°ç»„ç»‡** | æ˜Ÿæ ‡æ”¶è— | P0 | âœ… å·²å®ç° |
| | ç¬”è®°ç½®é¡¶ | P1 | âœ… å·²å®ç° |
| | æ ‡ç­¾åˆ†ç±» | P2 | âŒ æœªå®ç° |
| | æ–‡ä»¶å¤¹åˆ†ç»„ | P2 | âŒ æœªå®ç° |
| **æœç´¢** | å…¨æ–‡æœç´¢ | P0 | âœ… å·²å®ç° |
| | å…³é”®è¯é«˜äº® | P1 | âœ… å·²å®ç° |
| | æœç´¢å†å² | P2 | âŒ æœªå®ç° |
| **å¯¼å…¥/å¯¼å‡º** | å¯¼å…¥ .nota æ–‡ä»¶ | P1 | âœ… å·²å®ç° |
| | å¯¼å…¥ .md æ–‡ä»¶ | P1 | âœ… å·²å®ç° |
| | å¯¼å‡º .nota æ–‡ä»¶ | P2 | âŒ æœªå®ç° |
| | å¯¼å‡º PDF | P2 | âŒ æœªå®ç° |
| **è‡ªåŠ¨åŒ–** | å³æ—¶è‡ªåŠ¨ä¿å­˜ | P0 | âœ… å·²å®ç° |
| | å¤±ç„¦è‡ªåŠ¨ä¿å­˜ | P1 | âœ… å·²å®ç° |
| | ç‰ˆæœ¬å†å² | P3 | âŒ æœªå®ç° |
| **ç•Œé¢** | äº®è‰²ä¸»é¢˜ | P0 | âœ… å·²å®ç° |
| | æš—è‰²ä¸»é¢˜ | P2 | âŒ æœªå®ç° |
| | è‡ªå®šä¹‰å­—ä½“ | P2 | âŒ æœªå®ç° |

---

## 3. ç•Œé¢ç»“æ„

### 3.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nota2                                    ğŸ” âš™ï¸ [çª—å£æ§åˆ¶]   â”‚ â† æ ‡é¢˜æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                  â”‚                                â”‚
â”‚          â”‚   ç¬”è®°åˆ—è¡¨åŒº      â”‚       ç¼–è¾‘å™¨åŒº                  â”‚
â”‚  ä¾§è¾¹æ   â”‚  (NoteListView)  â”‚   (NoteEditorView)             â”‚
â”‚          â”‚                  â”‚                                â”‚
â”‚  [åˆ†ç±»]  â”‚  [ç¬”è®°å¡ç‰‡1]     â”‚   # ç¬”è®°æ ‡é¢˜                    â”‚
â”‚          â”‚  [ç¬”è®°å¡ç‰‡2]     â”‚                                â”‚
â”‚  å…¨éƒ¨    â”‚  [ç¬”è®°å¡ç‰‡3]     â”‚   ç¬”è®°å†…å®¹...                   â”‚
â”‚  â­æ˜Ÿæ ‡  â”‚  [ç¬”è®°å¡ç‰‡4]     â”‚                                â”‚
â”‚  ğŸ—‘å·²åˆ é™¤ â”‚  [ç¬”è®°å¡ç‰‡5]     â”‚                                â”‚
â”‚          â”‚  ...             â”‚                                â”‚
â”‚          â”‚                  â”‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â³ ä¿å­˜ä¸­ | å…± 42 ç¯‡ç¬”è®°                                       â”‚ â† çŠ¶æ€æ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç•Œé¢åŒºåŸŸè¯¦è§£

#### 3.2.1 ä¾§è¾¹æ  (Sidebar)

**ä½ç½®**: çª—å£æœ€å·¦ä¾§  
**å®½åº¦**: å›ºå®šå®½åº¦ï¼ˆçº¦ 200pxï¼‰  
**åŠŸèƒ½**: åˆ†ç±»å¯¼èˆªå’Œç»Ÿè®¡

**åˆ†ç±»åˆ—è¡¨**:
```
ğŸ“ å…¨éƒ¨ç¬”è®° (42)
â­ æ˜Ÿæ ‡ç¬”è®° (8)
ğŸ—‘ï¸ å·²åˆ é™¤ (3)
```

**äº¤äº’**:
- ç‚¹å‡»åˆ†ç±» â†’ åˆ‡æ¢ç¬”è®°åˆ—è¡¨è¿‡æ»¤
- æ˜¾ç¤ºæ¯ä¸ªåˆ†ç±»çš„ç¬”è®°æ•°é‡
- å½“å‰é€‰ä¸­åˆ†ç±»é«˜äº®æ˜¾ç¤º

---

#### 3.2.2 ç¬”è®°åˆ—è¡¨åŒº (NoteListView)

**ä½ç½®**: ä¾§è¾¹æ å³ä¾§  
**å®½åº¦**: å¯è°ƒæ•´ï¼ˆçº¦ 300-400pxï¼‰  
**åŠŸèƒ½**: å±•ç¤ºç¬”è®°åˆ—è¡¨

**ç¬”è®°å¡ç‰‡ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Œ ç¬”è®°æ ‡é¢˜ (æœ€å¤šæ˜¾ç¤º 2 è¡Œ)          â­â”‚  â† æ ‡é¢˜ + æ˜Ÿæ ‡å›¾æ ‡
â”‚ ç¬”è®°é¢„è§ˆå†…å®¹ï¼Œæœ€å¤šæ˜¾ç¤º 3 è¡Œ...       â”‚  â† å†…å®¹é¢„è§ˆ
â”‚ 2025-11-15 14:30                   â”‚  â† æ›´æ–°æ—¶é—´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¡ç‰‡å…ƒç´ **:
- **ç½®é¡¶å›¾æ ‡** (ğŸ“Œ): ç½®é¡¶ç¬”è®°æ˜¾ç¤º
- **æ˜Ÿæ ‡å›¾æ ‡** (â­): æ˜Ÿæ ‡ç¬”è®°æ˜¾ç¤º
- **æ ‡é¢˜**: æœ€å¤š 2 è¡Œï¼Œè¶…å‡ºæ˜¾ç¤ºçœç•¥å·
- **é¢„è§ˆ**: æœ€å¤š 3 è¡Œï¼Œè¶…å‡ºæ˜¾ç¤ºçœç•¥å·
- **æ—¶é—´**: æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´

**æ’åºè§„åˆ™**:
1. **ç½®é¡¶ç¬”è®°** â†’ å›ºå®šåœ¨åˆ—è¡¨æœ€ä¸Šæ–¹
2. **éç½®é¡¶ç¬”è®°** â†’ æŒ‰æ›´æ–°æ—¶é—´å€’åº (æœ€æ–°åœ¨å‰)

**çŠ¶æ€**:
- **é€‰ä¸­**: èƒŒæ™¯è‰²é«˜äº® (`NSColor.accentColor.opacity(0.2)`)
- **æ‚¬åœ**: èƒŒæ™¯è‰²å¾®å˜ï¼ˆå¯é€‰ï¼‰
- **ç©ºçŠ¶æ€**: æ˜¾ç¤º "æš‚æ— ç¬”è®°" æç¤º

**æ»šåŠ¨**:
- æ”¯æŒé¼ æ ‡æ»šè½®æ»šåŠ¨
- é€‰ä¸­ç¬”è®°æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ

---

#### 3.2.3 ç¼–è¾‘å™¨åŒº (NoteEditorView)

**ä½ç½®**: çª—å£å³ä¾§ï¼Œå æ®æœ€å¤§ç©ºé—´  
**åŠŸèƒ½**: ç¬”è®°å†…å®¹ç¼–è¾‘

**ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æ ‡é¢˜è¾“å…¥æ¡†]                      â­ ğŸ—‘ï¸â”‚  â† æ ‡é¢˜æ  + æ“ä½œæŒ‰é’®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  # ç¬”è®°æ ‡é¢˜                              â”‚
â”‚                                         â”‚
â”‚  è¿™æ˜¯ç¬”è®°çš„æ­£æ–‡å†…å®¹ï¼Œæ”¯æŒ Markdown...    â”‚  â† å†…å®¹ç¼–è¾‘åŒº
â”‚                                         â”‚
â”‚  - åˆ—è¡¨é¡¹ 1                             â”‚
â”‚  - åˆ—è¡¨é¡¹ 2                             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶**:
1. **æ ‡é¢˜è¾“å…¥æ¡†** (NSTextField)
   - å æ®é¡¶éƒ¨ä¸€è¡Œ
   - æ— è¾¹æ¡†æ ·å¼
   - å­—ä½“è¾ƒå¤§ï¼ˆ17ptï¼‰
   - Placeholder: "æ— æ ‡é¢˜"

2. **æ“ä½œæŒ‰é’®**
   - **æ˜Ÿæ ‡æŒ‰é’®** (â­): åˆ‡æ¢ç¬”è®°æ”¶è—çŠ¶æ€
   - **åˆ é™¤æŒ‰é’®** (ğŸ—‘ï¸): åˆ é™¤å½“å‰ç¬”è®°

3. **å†…å®¹ç¼–è¾‘åŒº** (NSTextView)
   - æ”¯æŒ Markdown è¯­æ³•
   - çº¯æ–‡æœ¬æ¨¡å¼ï¼ˆæ— å®æ—¶æ¸²æŸ“ï¼‰
   - æ”¯æŒæœç´¢å…³é”®è¯é«˜äº®
   - è‡ªåŠ¨ä¿å­˜ï¼ˆ0.8 ç§’é˜²æŠ–ï¼‰

**æ¨¡å¼**:
- **ç¼–è¾‘æ¨¡å¼** (Edit Mode): å½“å‰å”¯ä¸€æ¨¡å¼
- **é¢„è§ˆæ¨¡å¼** (Preview Mode): æœªå®ç°

**ç©ºçŠ¶æ€**:
- æœªé€‰ä¸­ç¬”è®°: æ˜¾ç¤º "æš‚æ— ç¬”è®°" æˆ–ç©ºç™½
- å¤šé€‰çŠ¶æ€: æ˜¾ç¤º "å·²é€‰ä¸­ N ç¯‡ç¬”è®°"

---

#### 3.2.4 çŠ¶æ€æ  (StatusBarView)

**ä½ç½®**: çª—å£åº•éƒ¨  
**é«˜åº¦**: å›ºå®šé«˜åº¦ï¼ˆçº¦ 24pxï¼‰  
**åŠŸèƒ½**: æ˜¾ç¤ºåº”ç”¨çŠ¶æ€

**æ˜¾ç¤ºå†…å®¹**:
```
â³ ä¿å­˜ä¸­  |  å…± 42 ç¯‡ç¬”è®°  |  é€‰ä¸­ 1 ç¯‡
```

**çŠ¶æ€ç±»å‹**:
1. **ä¿å­˜çŠ¶æ€**
   - `â³ ä¿å­˜ä¸­`: æ­£åœ¨ä¿å­˜ï¼ˆæ˜¾ç¤º 3 ç§’åè‡ªåŠ¨éšè—ï¼‰
   - ç©ºç™½: ç©ºé—²çŠ¶æ€ï¼ˆè‡ªåŠ¨éšè—ï¼‰

2. **ç»Ÿè®¡ä¿¡æ¯**
   - å½“å‰åˆ†ç±»çš„ç¬”è®°æ€»æ•°
   - å½“å‰é€‰ä¸­çš„ç¬”è®°æ•°é‡

**æ ·å¼**:
- å­—ä½“: ç³»ç»Ÿå­—ä½“ 11pt
- é¢œè‰²: æ¬¡è¦æ–‡æœ¬é¢œè‰² (`secondaryLabelColor`)
- èƒŒæ™¯: é€æ˜

---

### 3.3 æœç´¢é¢æ¿

**è§¦å‘æ–¹å¼**:
- ç‚¹å‡»æ ‡é¢˜æ æœç´¢å›¾æ ‡ (ğŸ”)
- å¿«æ·é”®: `âŒ˜F`

**UI ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” [æœç´¢è¾“å…¥æ¡†]              [âœ•]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**:
- å®æ—¶æœç´¢ï¼ˆè¾“å…¥å³æœç´¢ï¼‰
- æœç´¢èŒƒå›´: æ ‡é¢˜ + å†…å®¹
- æœç´¢ç»“æœ: è‡ªåŠ¨è¿‡æ»¤ç¬”è®°åˆ—è¡¨
- å…³é”®è¯é«˜äº®: ç¼–è¾‘å™¨ä¸­é«˜äº®åŒ¹é…è¯

**å…³é—­æ–¹å¼**:
- ç‚¹å‡»å…³é—­æŒ‰é’® (âœ•)
- æŒ‰ `ESC` é”®
- æ¸…ç©ºæœç´¢è¯è‡ªåŠ¨éšè—

---

## 4. äº¤äº’è®¾è®¡

### 4.1 èœå•æ  (MenuBar)

#### 4.1.1 Nota2 èœå•
```
Nota2
â”œâ”€ å…³äº Nota2
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ åå¥½è®¾ç½®...       âŒ˜,
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ éšè— Nota2        âŒ˜H
â”œâ”€ éšè—å…¶ä»–          âŒ¥âŒ˜H
â”œâ”€ æ˜¾ç¤ºå…¨éƒ¨
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€ é€€å‡º Nota2        âŒ˜Q
```

#### 4.1.2 æ–‡ä»¶èœå• (File)
```
æ–‡ä»¶
â”œâ”€ æ–°å»ºç¬”è®°          âŒ˜N
â”œâ”€ å¯¼å…¥ç¬”è®°...       âŒ˜O
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ ä¿å­˜             âŒ˜S
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ åˆ é™¤ç¬”è®°         âŒ˜âŒ«
â””â”€ å…³é—­çª—å£         âŒ˜W
```

#### 4.1.3 ç¼–è¾‘èœå• (Edit)
```
ç¼–è¾‘
â”œâ”€ æ’¤é”€            âŒ˜Z
â”œâ”€ é‡åš            â‡§âŒ˜Z
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ å‰ªåˆ‡            âŒ˜X
â”œâ”€ å¤åˆ¶            âŒ˜C
â”œâ”€ ç²˜è´´            âŒ˜V
â”œâ”€ å…¨é€‰            âŒ˜A
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€ æŸ¥æ‰¾            âŒ˜F
```

#### 4.1.4 æŸ¥çœ‹èœå• (View)
```
æŸ¥çœ‹
â”œâ”€ åˆ·æ–°åˆ—è¡¨         âŒ˜R
â””â”€ è¿›å…¥å…¨å±         âŒƒâŒ˜F
```

#### 4.1.5 çª—å£èœå• (Window)
```
çª—å£
â”œâ”€ æœ€å°åŒ–           âŒ˜M
â”œâ”€ ç¼©æ”¾
â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€ å‰ç½®å…¨éƒ¨çª—å£
```

#### 4.1.6 å¸®åŠ©èœå• (Help)
```
å¸®åŠ©
â””â”€ Nota2 å¸®åŠ©
```

---

### 4.2 å³é”®èœå• (Context Menu)

#### 4.2.1 ç¬”è®°åˆ—è¡¨å³é”®èœå•

**å•é€‰çŠ¶æ€**:
```
ğŸ“ æ‰“å¼€ç¬”è®°
â­ æ˜Ÿæ ‡ / å–æ¶ˆæ˜Ÿæ ‡
ğŸ“Œ ç½®é¡¶ / å–æ¶ˆç½®é¡¶
ğŸ—‘ï¸ åˆ é™¤
```

**å¤šé€‰çŠ¶æ€**:
```
æ‰¹é‡æ“ä½œ
â”œâ”€ â­ æ‰¹é‡æ˜Ÿæ ‡
â”œâ”€ ğŸ“Œ æ‰¹é‡ç½®é¡¶
â”œâ”€ ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤
â””â”€ âŒ å–æ¶ˆé€‰æ‹©
```

**å·²åˆ é™¤ç¬”è®°åˆ—è¡¨å³é”®èœå•**:
```
ğŸ”„ æ¢å¤ç¬”è®°
ğŸ’¥ æ°¸ä¹…åˆ é™¤
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ æ‰¹é‡æ¢å¤
ğŸ’¥ æ‰¹é‡æ°¸ä¹…åˆ é™¤
```

#### 4.2.2 ç¼–è¾‘å™¨å³é”®èœå•
```
âœ‚ï¸ å‰ªåˆ‡
ğŸ“‹ å¤åˆ¶
ğŸ“Œ ç²˜è´´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ” æŸ¥æ‰¾...
```

---

### 4.3 å¿«æ·é”® (Keyboard Shortcuts)

| åŠŸèƒ½ | å¿«æ·é”® | è¯´æ˜ |
|-----|--------|------|
| **ç¬”è®°æ“ä½œ** |
| æ–°å»ºç¬”è®° | `âŒ˜N` | åˆ›å»ºæ–°ç¬”è®° |
| ä¿å­˜ç¬”è®° | `âŒ˜S` | ç«‹å³åŒæ­¥ä¿å­˜ |
| åˆ é™¤ç¬”è®° | `âŒ˜âŒ«` | åˆ é™¤å½“å‰ç¬”è®° |
| å¯¼å…¥ç¬”è®° | `âŒ˜O` | æ‰“å¼€å¯¼å…¥å¯¹è¯æ¡† |
| **ç¼–è¾‘æ“ä½œ** |
| æ’¤é”€ | `âŒ˜Z` | æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ |
| é‡åš | `â‡§âŒ˜Z` | é‡åš |
| å‰ªåˆ‡ | `âŒ˜X` | å‰ªåˆ‡é€‰ä¸­æ–‡æœ¬ |
| å¤åˆ¶ | `âŒ˜C` | å¤åˆ¶é€‰ä¸­æ–‡æœ¬ |
| ç²˜è´´ | `âŒ˜V` | ç²˜è´´æ–‡æœ¬ |
| å…¨é€‰ | `âŒ˜A` | å…¨é€‰æ–‡æœ¬ |
| æŸ¥æ‰¾ | `âŒ˜F` | æ‰“å¼€æœç´¢é¢æ¿ |
| **çª—å£æ“ä½œ** |
| åˆ·æ–°åˆ—è¡¨ | `âŒ˜R` | åˆ·æ–°ç¬”è®°åˆ—è¡¨ |
| å…³é—­çª—å£ | `âŒ˜W` | å…³é—­å½“å‰çª—å£ |
| æœ€å°åŒ– | `âŒ˜M` | æœ€å°åŒ–çª—å£ |
| å…¨å± | `âŒƒâŒ˜F` | è¿›å…¥/é€€å‡ºå…¨å± |
| é€€å‡ºåº”ç”¨ | `âŒ˜Q` | é€€å‡º Nota2 |

---

### 4.4 é¼ æ ‡äº¤äº’

#### 4.4.1 ç¬”è®°åˆ—è¡¨

| æ“ä½œ | æ•ˆæœ |
|-----|------|
| **å•å‡»** | é€‰ä¸­ç¬”è®°ï¼ŒåŠ è½½åˆ°ç¼–è¾‘å™¨ |
| **åŒå‡»** | ï¼ˆæœªå®šä¹‰ï¼ŒåŒå•å‡»ï¼‰ |
| **å³é”®å•å‡»** | æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå• |
| **âŒ˜ + å•å‡»** | å¤šé€‰ç¬”è®°ï¼ˆæ·»åŠ åˆ°é€‰åŒºï¼‰ |
| **â‡§ + å•å‡»** | èŒƒå›´é€‰æ‹©ï¼ˆä»ä¸Šæ¬¡é€‰ä¸­åˆ°å½“å‰ï¼‰ |
| **æ‹–æ‹½** | ï¼ˆæœªå®ç°ï¼‰ |

#### 4.4.2 ç¼–è¾‘å™¨

| æ“ä½œ | æ•ˆæœ |
|-----|------|
| **å•å‡»** | å®šä½å…‰æ ‡ |
| **åŒå‡»** | é€‰ä¸­å•è¯ |
| **ä¸‰å‡»** | é€‰ä¸­æ•´è¡Œ |
| **æ‹–æ‹½é€‰æ‹©** | é€‰ä¸­æ–‡æœ¬ |
| **å³é”®å•å‡»** | æ˜¾ç¤ºç¼–è¾‘èœå• |

#### 4.4.3 æ˜Ÿæ ‡/ç½®é¡¶æŒ‰é’®

| æ“ä½œ | æ•ˆæœ |
|-----|------|
| **ç‚¹å‡»æ˜Ÿæ ‡æŒ‰é’®** | åˆ‡æ¢æ˜Ÿæ ‡çŠ¶æ€ |
| **ç‚¹å‡»ç½®é¡¶æŒ‰é’®** | åˆ‡æ¢ç½®é¡¶çŠ¶æ€ï¼ˆæœªæ˜ç¡®å®ç°ï¼‰ |

---

### 4.5 çŠ¶æ€ç®¡ç†

#### 4.5.1 ç¬”è®°é€‰ä¸­çŠ¶æ€

**å•ä¸€æ•°æ®æº**: `NoteListViewController.currentSelectedNoteId`

**çŠ¶æ€æµè½¬**:
```
æœªé€‰ä¸­ â†’ å•å‡»ç¬”è®° â†’ é€‰ä¸­çŠ¶æ€
é€‰ä¸­çŠ¶æ€ â†’ å•å‡»å…¶ä»–ç¬”è®° â†’ åˆ‡æ¢é€‰ä¸­
é€‰ä¸­çŠ¶æ€ â†’ å¤šé€‰(âŒ˜+å•å‡») â†’ å¤šé€‰çŠ¶æ€
å¤šé€‰çŠ¶æ€ â†’ å•å‡»ç¬”è®° â†’ å•é€‰çŠ¶æ€
```

**UI åŒæ­¥**:
- `tableView.selectedRowIndexes` ä½œä¸ºè§†å›¾å±‚é€‰ä¸­çŠ¶æ€
- é€‰ä¸­ç¬”è®°èƒŒæ™¯è‰²é«˜äº®
- é€‰ä¸­ç¬”è®°è‡ªåŠ¨æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ

#### 4.5.2 ç¬”è®°åˆ—è¡¨åˆ·æ–°

**è§¦å‘æ—¶æœº**:
1. åˆ›å»ºæ–°ç¬”è®°
2. æ›´æ–°ç¬”è®°ï¼ˆæ ‡é¢˜/å†…å®¹/æ˜Ÿæ ‡/ç½®é¡¶ï¼‰
3. åˆ é™¤ç¬”è®°
4. æ¢å¤ç¬”è®°
5. åˆ‡æ¢ä¾§è¾¹æ åˆ†ç±»
6. æœç´¢ç¬”è®°

**åˆ·æ–°ç­–ç•¥**:
- **éƒ¨åˆ†åˆ·æ–°**: å•ç¬”è®°æ›´æ–° â†’ `reloadData(forRowIndexes:columnIndexes:)`
- **å…¨éƒ¨åˆ·æ–°**: æ’åºå˜åŒ– â†’ `reloadData()`
- **ä¿æŒé€‰ä¸­**: åˆ·æ–°åæ¢å¤é€‰ä¸­çŠ¶æ€

#### 4.5.3 è‡ªåŠ¨ä¿å­˜çŠ¶æ€

**è§¦å‘æ¡ä»¶**:
1. **å†…å®¹å˜åŒ–** â†’ 0.8 ç§’é˜²æŠ–åè‡ªåŠ¨ä¿å­˜
2. **å¤§é‡ç²˜è´´** (>1000 å­—ç¬¦) â†’ ç«‹å³ä¿å­˜
3. **å¤±ç„¦äº‹ä»¶** (NSApplication.willResignActiveNotification) â†’ ç«‹å³ä¿å­˜
4. **æ‰‹åŠ¨ä¿å­˜** (âŒ˜S) â†’ ç«‹å³ä¿å­˜ + æ˜¾ç¤º "âœ“ å·²åŒæ­¥" Toast

**çŠ¶æ€æ˜¾ç¤º**:
- ä¿å­˜ä¸­: çŠ¶æ€æ æ˜¾ç¤º "â³ ä¿å­˜ä¸­"ï¼ˆ3 ç§’åè‡ªåŠ¨éšè—ï¼‰
- ä¿å­˜å®Œæˆ: çŠ¶æ€æ æ¢å¤ç©ºé—²

---

### 4.6 æ¨¡å¼åˆ‡æ¢

**å½“å‰æ¨¡å¼**:
- âœ… **ç¼–è¾‘æ¨¡å¼** (Edit Mode): å”¯ä¸€æ¨¡å¼ï¼Œç›´æ¥ç¼–è¾‘ Markdown æ–‡æœ¬

**æœªæ¥è§„åˆ’**:
- âŒ **é¢„è§ˆæ¨¡å¼** (Preview Mode): æ¸²æŸ“ Markdown ä¸º HTML
- âŒ **åˆ†å±æ¨¡å¼** (Split Mode): å·¦ä¾§ç¼–è¾‘ï¼Œå³ä¾§é¢„è§ˆ

---

### 4.7 ä¸»é¢˜è®¾ç½®

**å½“å‰ä¸»é¢˜**:
- âœ… **äº®è‰²ä¸»é¢˜** (Light Mode): é»˜è®¤ä¸»é¢˜
- âŒ **æš—è‰²ä¸»é¢˜** (Dark Mode): æœªå®ç°

**ä¸»é¢˜é€‚é…**:
- è·Ÿéšç³»ç»Ÿ (æœªå®ç°)
- æ‰‹åŠ¨åˆ‡æ¢ (æœªå®ç°)

---

## 5. æ•°æ®æ¶æ„

### 5.1 æ•°æ®æ¨¡å‹

#### 5.1.1 Note æ¨¡å‹

```swift
struct Note: Codable, Identifiable, Equatable {
    let id: Int64?                  // æ•°æ®åº“ä¸»é”®
    let noteId: String              // UUIDï¼Œå”¯ä¸€æ ‡è¯†
    var title: String               // ç¬”è®°æ ‡é¢˜
    var content: String             // ç¬”è®°å†…å®¹ (Markdown)
    let created: Date               // åˆ›å»ºæ—¶é—´
    var updated: Date               // æ›´æ–°æ—¶é—´
    var is_starred: Bool            // æ˜¯å¦æ˜Ÿæ ‡
    var is_pinned: Bool             // æ˜¯å¦ç½®é¡¶
    var is_deleted: Bool            // æ˜¯å¦å·²åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
    
    // è®¡ç®—å±æ€§
    var preview: String {           // å†…å®¹é¢„è§ˆï¼ˆå‰ 100 å­—ç¬¦ï¼‰
        let lines = content.split(separator: "\n")
        let preview = lines.prefix(3).joined(separator: " ")
        return String(preview.prefix(100))
    }
}
```

#### 5.1.2 æ•°æ®åº“ Schema

**è¡¨å**: `notes`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|-------|------|------|------|
| `id` | INTEGER | ä¸»é”® | PRIMARY KEY, AUTOINCREMENT |
| `noteId` | TEXT | UUID å”¯ä¸€æ ‡è¯† | NOT NULL, UNIQUE |
| `title` | TEXT | æ ‡é¢˜ | DEFAULT '' |
| `content` | TEXT | å†…å®¹ | DEFAULT '' |
| `created` | DATETIME | åˆ›å»ºæ—¶é—´ | NOT NULL |
| `updated` | DATETIME | æ›´æ–°æ—¶é—´ | NOT NULL |
| `is_starred` | BOOLEAN | æ˜¯å¦æ˜Ÿæ ‡ | DEFAULT 0 |
| `is_pinned` | BOOLEAN | æ˜¯å¦ç½®é¡¶ | DEFAULT 0 |
| `is_deleted` | BOOLEAN | æ˜¯å¦åˆ é™¤ | DEFAULT 0 |

**ç´¢å¼•**:
```sql
CREATE INDEX idx_noteId ON notes(noteId);
CREATE INDEX idx_is_deleted ON notes(is_deleted);
CREATE INDEX idx_is_starred ON notes(is_starred);
CREATE INDEX idx_updated ON notes(updated DESC);
```

---

### 5.2 æ–‡ä»¶å­˜å‚¨

#### 5.2.1 ç›®å½•ç»“æ„

```
~/Library/Application Support/Nota2/
â”œâ”€â”€ data.db                    # SQLite æ•°æ®åº“
â”œâ”€â”€ notes/                     # ç¬”è®°æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ {noteId1}.nota        # ç¬”è®°æ–‡ä»¶
â”‚   â”œâ”€â”€ {noteId2}.nota
â”‚   â””â”€â”€ ...
â””â”€â”€ trash/                     # å·²åˆ é™¤ç¬”è®°ç›®å½•
    â”œâ”€â”€ {noteId3}.nota
    â””â”€â”€ ...
```

#### 5.2.2 æ–‡ä»¶å‘½åè§„åˆ™

**æ ¼å¼**: `{noteId}.nota`

**ç¤ºä¾‹**: `A464F114-7334-42E8-B58C-69E82F10E461.nota`

**ç‰¹ç‚¹**:
- ä½¿ç”¨ UUID ä½œä¸ºæ–‡ä»¶å
- æ‰©å±•å: `.nota`
- æ–‡ä»¶å†…å®¹: çº¯æ–‡æœ¬ Markdown

#### 5.2.3 æ–‡ä»¶æ“ä½œ

| æ“ä½œ | æºç›®å½• | ç›®æ ‡ç›®å½• | æ•°æ®åº“æ“ä½œ |
|-----|-------|---------|-----------|
| **åˆ›å»ºç¬”è®°** | - | `notes/` | INSERT |
| **æ›´æ–°ç¬”è®°** | `notes/` | `notes/` | UPDATE |
| **åˆ é™¤ç¬”è®°** | `notes/` | `trash/` | UPDATE is_deleted=1 |
| **æ¢å¤ç¬”è®°** | `trash/` | `notes/` | UPDATE is_deleted=0 |
| **æ°¸ä¹…åˆ é™¤** | `trash/` | - (åˆ é™¤) | DELETE |

---

### 5.3 æ•°æ®æµ

#### 5.3.1 åˆ›å»ºç¬”è®°æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» "æ–°å»ºç¬”è®°" (âŒ˜N)
    â†“
MainWindowController.newNote()
    â†“
NoteEditorViewModel.createNewNote()
    â†“
1. ç”Ÿæˆ UUID noteId
2. åˆ›å»º Note å¯¹è±¡
3. ä¿å­˜åˆ°æ•°æ®åº“ (NoteRepository.createNote)
4. åˆ›å»º .nota æ–‡ä»¶ (NotaFileManager.createFile)
    â†“
åˆ·æ–°ç¬”è®°åˆ—è¡¨ (NoteListViewModel.refresh)
    â†“
é€‰ä¸­æ–°ç¬”è®° (NoteListViewController.selectNote)
    â†“
ç¼–è¾‘å™¨åŠ è½½æ–°ç¬”è®° (NoteEditorViewModel.loadNote)
```

#### 5.3.2 æ›´æ–°ç¬”è®°æµç¨‹

```
ç”¨æˆ·ç¼–è¾‘å†…å®¹
    â†“
NoteEditorView.textDidChange
    â†“
é˜²æŠ–å™¨ (0.8 ç§’)
    â†“
NoteEditorViewModel.autoSaveNote()
    â†“
1. æ›´æ–°æ•°æ®åº“ (NoteRepository.updateNote)
2. æ›´æ–° .nota æ–‡ä»¶ (NotaFileManager.updateFile)
    â†“
å‘é€é€šçŸ¥ (NotificationCenter: "NoteUpdated")
    â†“
NoteListViewController.handleNoteUpdated()
    â†“
åˆ·æ–°åˆ—è¡¨å•å…ƒæ ¼
```

#### 5.3.3 åˆ é™¤ç¬”è®°æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»åˆ é™¤ (âŒ˜âŒ« æˆ–å³é”®èœå•)
    â†“
NoteListViewModel.deleteNote()
    â†“
1. æ›´æ–°æ•°æ®åº“ is_deleted=1 (NoteRepository.updateNote)
2. ç§»åŠ¨æ–‡ä»¶åˆ° trash/ (NotaFileManager.moveToTrash)
    â†“
å‘é€é€šçŸ¥ (NotificationCenter: "NoteUpdated")
    â†“
åˆ·æ–°ç¬”è®°åˆ—è¡¨
    â†“
æ¸…ç©ºç¼–è¾‘å™¨ / é€‰ä¸­ä¸‹ä¸€ç¯‡ç¬”è®°
```

#### 5.3.4 æœç´¢ç¬”è®°æµç¨‹

```
ç”¨æˆ·è¾“å…¥æœç´¢å…³é”®è¯
    â†“
SearchViewModel.searchNotes(keyword)
    â†“
NoteRepository.searchNotes(keyword)
    â†“
SQL: SELECT * FROM notes 
     WHERE (title LIKE '%keyword%' OR content LIKE '%keyword%')
       AND is_deleted = 0
     ORDER BY updated DESC
    â†“
è¿”å›æœç´¢ç»“æœåˆ—è¡¨
    â†“
NoteListViewModel æ›´æ–° notes æ•°ç»„
    â†“
åˆ·æ–°ç¬”è®°åˆ—è¡¨
    â†“
ç¼–è¾‘å™¨ä¸­é«˜äº®å…³é”®è¯ (NoteEditorView.highlight)
```

---

### 5.4 æ•°æ®ä¸€è‡´æ€§

#### 5.4.1 æ•°æ®åº“ä¸æ–‡ä»¶åŒæ­¥

**åŸåˆ™**: æ•°æ®åº“ä¸ºä¸»ï¼Œæ–‡ä»¶ä¸ºè¾…

**åŒæ­¥æ—¶æœº**:
- **åˆ›å»º**: å…ˆæ•°æ®åº“ â†’ å†æ–‡ä»¶
- **æ›´æ–°**: å…ˆæ•°æ®åº“ â†’ å†æ–‡ä»¶
- **åˆ é™¤**: å…ˆæ•°æ®åº“ â†’ å†ç§»åŠ¨æ–‡ä»¶
- **æ¢å¤**: å…ˆæ•°æ®åº“ â†’ å†ç§»åŠ¨æ–‡ä»¶
- **æ°¸ä¹…åˆ é™¤**: å…ˆåˆ é™¤æ–‡ä»¶ â†’ å†åˆ é™¤æ•°æ®åº“

**å†²çªå¤„ç†**:
- æ–‡ä»¶å­˜åœ¨ä½†æ•°æ®åº“æ— è®°å½• â†’ å¯¼å…¥ä¸ºæ–°ç¬”è®°
- æ•°æ®åº“æœ‰è®°å½•ä½†æ–‡ä»¶ç¼ºå¤± â†’ ä»å†…å®¹å­—æ®µæ¢å¤
- ç§»åŠ¨æ–‡ä»¶æ—¶ç›®æ ‡å·²å­˜åœ¨ â†’ åˆ é™¤ç›®æ ‡åå†ç§»åŠ¨

#### 5.4.2 çŠ¶æ€åŒæ­¥

**UI çŠ¶æ€ â†’ æ•°æ®åº“çŠ¶æ€**:
- æ˜Ÿæ ‡æŒ‰é’®ç‚¹å‡» â†’ æ›´æ–° `is_starred` å­—æ®µ
- ç½®é¡¶æ“ä½œ â†’ æ›´æ–° `is_pinned` å­—æ®µ
- åˆ é™¤æ“ä½œ â†’ æ›´æ–° `is_deleted` å­—æ®µ

**æ•°æ®åº“çŠ¶æ€ â†’ UI çŠ¶æ€**:
- ç›‘å¬ `NotificationCenter` é€šçŸ¥
- åˆ·æ–°åˆ—è¡¨ UI
- æ›´æ–°ä¾§è¾¹æ ç»Ÿè®¡æ•°é‡

---

## 6. æŠ€æœ¯å®ç°

### 6.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|-----|------|------|
| **è¯­è¨€** | Swift 5.9+ | macOS åŸç”Ÿå¼€å‘è¯­è¨€ |
| **UI æ¡†æ¶** | AppKit | macOS åŸç”Ÿ UI æ¡†æ¶ |
| **æ•°æ®åº“** | GRDB (SQLite) | è½»é‡çº§æœ¬åœ°æ•°æ®åº“ |
| **åŒ…ç®¡ç†** | Swift Package Manager | Apple å®˜æ–¹åŒ…ç®¡ç†å·¥å…· |
| **æ¶æ„æ¨¡å¼** | MVVM | Model-View-ViewModel |
| **å“åº”å¼** | Combine | Apple å®˜æ–¹å“åº”å¼æ¡†æ¶ |

### 6.2 æ¶æ„è®¾è®¡

#### 6.2.1 MVVM æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   View                       â”‚
â”‚  (NSViewController, NSView)                  â”‚
â”‚  - NoteListViewController                    â”‚
â”‚  - NoteEditorView                            â”‚
â”‚  - SidebarView                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Binding (Combine)
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ViewModel                    â”‚
â”‚  (ObservableObject)                          â”‚
â”‚  - NoteListViewModel                         â”‚
â”‚  - NoteEditorViewModel                       â”‚
â”‚  - SearchViewModel                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Business Logic
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Model                       â”‚
â”‚  (Struct, Service)                           â”‚
â”‚  - Note                                      â”‚
â”‚  - NoteRepository                            â”‚
â”‚  - NotaFileManager                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.2.2 æ ¸å¿ƒç»„ä»¶

**è§†å›¾å±‚ (View)**:
- `MainWindowController`: ä¸»çª—å£æ§åˆ¶å™¨
- `NoteListViewController`: ç¬”è®°åˆ—è¡¨æ§åˆ¶å™¨
- `NoteEditorView`: ç¼–è¾‘å™¨è§†å›¾
- `SidebarDataSource`: ä¾§è¾¹æ æ•°æ®æº
- `StatusBarView`: çŠ¶æ€æ è§†å›¾

**è§†å›¾æ¨¡å‹ (ViewModel)**:
- `NoteListViewModel`: ç¬”è®°åˆ—è¡¨é€»è¾‘
- `NoteEditorViewModel`: ç¼–è¾‘å™¨é€»è¾‘
- `SearchViewModel`: æœç´¢é€»è¾‘

**æ¨¡å‹å±‚ (Model)**:
- `Note`: ç¬”è®°æ•°æ®æ¨¡å‹
- `NoteRepository`: æ•°æ®åº“æ“ä½œ
- `NotaFileManager`: æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `FileImportService`: å¯¼å…¥æœåŠ¡

**å·¥å…·ç±» (Utilities)**:
- `Debouncer`: é˜²æŠ–å™¨ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
- `DatabaseManager`: æ•°æ®åº“ç®¡ç†
- `AppConfig`: åº”ç”¨é…ç½®

---

### 6.3 å…³é”®æŠ€æœ¯ç‚¹

#### 6.3.1 å³æ—¶ä¿å­˜æœºåˆ¶

**é˜²æŠ–ç­–ç•¥**:
```swift
class Debouncer {
    private let interval: TimeInterval = 0.8  // é˜²æŠ–é—´éš”
    private var timer: Timer?
    
    func reset() {
        timer?.invalidate()
        timer = Timer.scheduledTimer(
            timeInterval: interval,
            target: self,
            selector: #selector(fire),
            userInfo: nil,
            repeats: false
        )
    }
    
    @objc private func fire() {
        // è§¦å‘ä¿å­˜
        saveNote()
    }
}
```

**ä¿å­˜æ—¶æœº**:
1. å†…å®¹å˜åŒ– â†’ 0.8 ç§’é˜²æŠ–
2. å¤§é‡ç²˜è´´ (>1000 å­—ç¬¦) â†’ ç«‹å³ä¿å­˜
3. å¤±ç„¦äº‹ä»¶ â†’ ç«‹å³ä¿å­˜

#### 6.3.2 å…‰æ ‡ä½ç½®ä¿æŒ

**é—®é¢˜**: è‡ªåŠ¨ä¿å­˜æ—¶ï¼Œé‡æ–°åŠ è½½å†…å®¹ä¼šå¯¼è‡´å…‰æ ‡è·³åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
```swift
func loadContent(_ newContent: String, clearUndoStack: Bool = false) {
    if textView.string == newContent { return }
    
    // ä¿å­˜å…‰æ ‡ä½ç½®
    let currentRange = textView.selectedRange()
    
    // æ›´æ–°å†…å®¹
    textView.string = newContent
    
    // æ¢å¤å…‰æ ‡ä½ç½®
    let maxLocation = (newContent as NSString).length
    if currentRange.location <= maxLocation {
        textView.setSelectedRange(currentRange)
    } else {
        textView.setSelectedRange(NSRange(location: maxLocation, length: 0))
    }
    
    // æŒ‰éœ€æ¸…ç©ºæ’¤é”€æ ˆ
    if clearUndoStack {
        textView.undoManager?.removeAllActions()
    }
}
```

**å…³é”®ç‚¹**:
- åŠ è½½æ–°ç¬”è®°æ—¶ â†’ æ¸…ç©ºæ’¤é”€æ ˆ
- è‡ªåŠ¨ä¿å­˜æ—¶ â†’ ä¿ç•™æ’¤é”€æ ˆå’Œå…‰æ ‡

#### 6.3.3 åˆ—è¡¨é€‰ä¸­çŠ¶æ€ç®¡ç†

**å•ä¸€æ•°æ®æº**: `currentSelectedNoteId`

**åŒæ­¥ç­–ç•¥**:
```swift
// 1. è®¾ç½® currentSelectedNoteId (Model)
currentSelectedNoteId = noteId

// 2. æ›´æ–° tableView.selectedRowIndexes (View)
tableView.selectRowIndexes(IndexSet(integer: index), byExtendingSelection: false)

// 3. æ›´æ–° Cell è§†è§‰çŠ¶æ€
updateCellSelectionStates()
```

**ä¼˜å…ˆçº§**:
- `currentSelectedNoteId` > `tableView.selectedRowIndexes`
- ä»¥ `currentSelectedNoteId` ä¸ºå‡†ï¼Œé¿å… UI åˆ·æ–°æ—¶çš„é€‰ä¸­çŠ¶æ€é”™ä¹±

#### 6.3.4 NSTableView Cell å¤ç”¨

**é—®é¢˜**: Cell å¤ç”¨å¯¼è‡´æ—§çŠ¶æ€æ®‹ç•™

**è§£å†³æ–¹æ¡ˆ**:
```swift
func tableView(_ tableView: NSTableView, viewFor tableColumn: NSTableColumn?, row: Int) -> NSView? {
    let cellView = tableView.makeView(withIdentifier: cellIdentifier, owner: self) as? NoteListItemView
    
    // âœ… ä¼˜å…ˆä½¿ç”¨ currentSelectedNoteId åˆ¤æ–­é€‰ä¸­çŠ¶æ€
    let isSelected = (note.noteId == currentSelectedNoteId)
    
    // âœ… é‡ç½®èƒŒæ™¯å’Œæ–‡å­—é¢œè‰²
    cellView?.backgroundStyle = isSelected ? .emphasized : .normal
    
    if isSelected {
        cellView?.forceTextColorToDark()
    } else {
        cellView?.resetTextColor()  // é‡ç½®ä¸ºé»˜è®¤é¢œè‰²
    }
    
    // é…ç½®å†…å®¹
    cellView?.configure(note: note)
    
    return cellView
}
```

---

## 7. æ–‡ä»¶æ ¼å¼

### 7.1 .nota æ–‡ä»¶æ ¼å¼

#### 7.1.1 æ ¼å¼è§„èŒƒ

**æ–‡ä»¶æ‰©å±•å**: `.nota`

**æ–‡ä»¶å†…å®¹**: çº¯æ–‡æœ¬ Markdown

**ç¼–ç **: UTF-8

**æ¢è¡Œç¬¦**: `\n` (Unix é£æ ¼)

**ç¤ºä¾‹**:
```markdown
# æˆ‘çš„ç¬¬ä¸€ç¯‡ç¬”è®°

è¿™æ˜¯ç¬”è®°çš„å†…å®¹ï¼Œæ”¯æŒ **Markdown** è¯­æ³•ã€‚

- åˆ—è¡¨é¡¹ 1
- åˆ—è¡¨é¡¹ 2

## äºŒçº§æ ‡é¢˜

æ›´å¤šå†…å®¹...
```

#### 7.1.2 å…ƒæ•°æ®å­˜å‚¨

**æ–¹å¼**: ä¸å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“

**ç†ç”±**:
- æ–‡ä»¶ä»…ç”¨äºå†…å®¹å¤‡ä»½
- å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€åˆ›å»ºæ—¶é—´ã€æ˜Ÿæ ‡ç­‰ï¼‰å­˜å‚¨åœ¨æ•°æ®åº“
- é¿å…æ–‡ä»¶å¤´æ±¡æŸ“ï¼Œä¿æŒçº¯ Markdown

#### 7.1.3 æ–‡ä»¶å¯¼å…¥

**æ”¯æŒæ ¼å¼**:
- `.nota` æ–‡ä»¶
- `.md` / `.markdown` æ–‡ä»¶

**å¯¼å…¥é€»è¾‘**:
```swift
func importNote(from sourceURL: URL) throws -> String {
    // 1. è¯»å–æ–‡ä»¶å†…å®¹
    let content = try String(contentsOf: sourceURL, encoding: .utf8)
    
    // 2. æå–æ ‡é¢˜ï¼ˆä½¿ç”¨æ–‡ä»¶åï¼‰
    let title = sourceURL.deletingPathExtension().lastPathComponent
    
    // 3. ç”Ÿæˆ noteId
    let noteId = UUID().uuidString
    
    // 4. ä¿å­˜åˆ°æ•°æ®åº“
    let note = Note(
        id: nil,
        noteId: noteId,
        title: title,
        content: content,
        created: Date(),
        updated: Date(),  // âœ… è®¾ç½®ä¸ºå½“å‰å¯¼å…¥æ—¶é—´
        is_starred: false,
        is_pinned: false,
        is_deleted: false
    )
    try noteRepository.createNote(note)
    
    // 5. ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ
    let targetURL = notesDirectory.appendingPathComponent("\(noteId).nota")
    try content.write(to: targetURL, atomically: true, encoding: .utf8)
    
    return noteId
}
```

**å¯¼å…¥åå¤„ç†**:
- è®¾ç½® `updated` ä¸ºå½“å‰æ—¶é—´ â†’ æ’åœ¨åˆ—è¡¨æœ€å‰é¢
- ä½¿ç”¨æ–‡ä»¶åä½œä¸ºç¬”è®°æ ‡é¢˜

---

### 7.2 æ•°æ®åº“å¯¼å‡º (æœªæ¥è§„åˆ’)

**å¯¼å‡ºæ ¼å¼é€‰é¡¹**:
1. `.nota` å•æ–‡ä»¶
2. `.md` Markdown æ–‡ä»¶
3. `.pdf` PDF æ–‡æ¡£
4. `.zip` æ‰¹é‡å¯¼å‡º

**å¯¼å‡ºå†…å®¹**:
- æ ‡é¢˜ä½œä¸ºæ–‡ä»¶å
- å†…å®¹ä½œä¸ºæ–‡ä»¶æ­£æ–‡
- å…ƒæ•°æ®å¯é€‰ï¼ˆYAML Front Matterï¼‰

**ç¤ºä¾‹ (å«å…ƒæ•°æ®)**:
```markdown
---
title: æˆ‘çš„ç¬¬ä¸€ç¯‡ç¬”è®°
created: 2025-11-15T10:30:00Z
updated: 2025-11-15T14:20:00Z
starred: true
pinned: false
---

# æˆ‘çš„ç¬¬ä¸€ç¯‡ç¬”è®°

ç¬”è®°å†…å®¹...
```

---

## 8. é™„å½•

### 8.1 é”™è¯¯å¤„ç†

**é”™è¯¯ç±»å‹**:
- æ–‡ä»¶è¯»å†™é”™è¯¯
- æ•°æ®åº“æ“ä½œé”™è¯¯
- æ–‡ä»¶ç§»åŠ¨å†²çªé”™è¯¯

**å¤„ç†ç­–ç•¥**:
- æ•è·é”™è¯¯å¹¶è®°å½•æ—¥å¿—
- å‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½æç¤º
- æä¾›é‡è¯•æœºåˆ¶

### 8.2 æ€§èƒ½ä¼˜åŒ–

**å·²å®æ–½**:
- ç¬”è®°åˆ—è¡¨è™šæ‹ŸåŒ–ï¼ˆNSTableView è‡ªåŠ¨å¤„ç†ï¼‰
- éƒ¨åˆ†åˆ·æ–° vs å…¨éƒ¨åˆ·æ–°
- é˜²æŠ–è‡ªåŠ¨ä¿å­˜

**æœªæ¥ä¼˜åŒ–**:
- å¤§æ–‡ä»¶åˆ†æ®µåŠ è½½
- æœç´¢ç»“æœåˆ†é¡µ
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆç´¢å¼•ï¼‰

### 8.3 æœªæ¥è§„åˆ’

**P1 (é«˜ä¼˜å…ˆçº§)**:
- [ ] æš—è‰²ä¸»é¢˜
- [ ] å¯¼å‡ºåŠŸèƒ½
- [ ] æ ‡ç­¾ç³»ç»Ÿ
- [ ] å¿«æ·é”®è‡ªå®šä¹‰

**P2 (ä¸­ä¼˜å…ˆçº§)**:
- [ ] Markdown é¢„è§ˆæ¨¡å¼
- [ ] åˆ†å±ç¼–è¾‘/é¢„è§ˆ
- [ ] å›¾ç‰‡ç²˜è´´æ”¯æŒ
- [ ] ç‰ˆæœ¬å†å²

**P3 (ä½ä¼˜å…ˆçº§)**:
- [ ] iCloud åŒæ­¥
- [ ] æ’ä»¶ç³»ç»Ÿ
- [ ] è‡ªå®šä¹‰ä¸»é¢˜
- [ ] Vim æ¨¡å¼

---

## 9. å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|-----|------|---------|
| v1.0.1 | 2025-11-15 | ä¿®å¤é€‰ä¸­çŠ¶æ€æ»ç•™é—®é¢˜ï¼Œä¼˜åŒ–å³æ—¶ä¿å­˜ |
| v1.0.0 | 2025-11-14 | åˆå§‹ç‰ˆæœ¬å‘å¸ƒ |

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Nota2 å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-15

